"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var RootCtrl=function e(t,n,r){var i=this;_classCallCheck(this,e),r.getMap().then(function(e){i.map=e}),n.getConfig().then(function(t){i.data=t;try{var e=document.createElement("canvas");t.modern=!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){t.modern=!1}})};function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}RootCtrl.$invoke=["$http","configService","mapService"],angular.module("IcsmApp",["common.altthemes","common.baselayer.control","common.cc","common.featureinfo","common.header","common.legend","common.navigation","common.reset","common.side-panel","common.slider","common.storage","common.templates","elvis.results","elvis.reviewing","explorer.config","explorer.confirm","explorer.drag","explorer.enter","explorer.flasher","explorer.httpdata","explorer.info","explorer.legend","explorer.message","explorer.modal","explorer.persist","explorer.projects","explorer.tabs","explorer.version","exp.ui.templates","explorer.map.templates","geo.draw","geo.elevation","geo.geosearch","geo.map","geo.maphelper","geo.measure","icsm.bounds","icsm.clip","icsm.contributors","icsm.coverage","icsm.elevation.point","icsm.glossary","icsm.header","icsm.help","icsm.imagery","icsm.layerswitch","icsm.mapevents","icsm.panes","icsm.parameters","icsm.polygon","icsm.point","icsm.products","icsm.preview","icsm.select","icsm.splash","icsm.templates","icsm.toolbar","icsm.view","ngAutocomplete","ngRoute","ngSanitize","page.footer","placenames.search","placenames.config","placenames.summary","ui.bootstrap","vcRecaptcha"]).config(["$locationProvider","configServiceProvider","placenamesConfigServiceProvider","projectsServiceProvider","persistServiceProvider","versionServiceProvider",function(e,t,n,r,i,a){e.html5Mode({enabled:!0,requireBase:!1}),t.location("icsm/resources/config/config.json?v=a"),n.location("icsm/resources/config/placenames.json"),a.url("icsm/assets/package.json"),r.setProject("icsm"),i.handler("local")}]).factory("userService",[function(){return{login:e,hasAcceptedTerms:e,setAcceptedTerms:e,getUsername:function(){return"anon"}};function e(){return!0}}]).controller("RootCtrl",RootCtrl),angular.module("icsm.clip",["geo.draw","explorer.clip.modal"]).directive("icsmInfoBbox",function(){return{restrict:"AE",templateUrl:"icsm/clip/infobbox.html"}}).directive("icsmClip",["$rootScope","$timeout","clipService","messageService","mapService",function(e,r,t,i,a){return{templateUrl:"icsm/clip/clip.html",scope:{bounds:"=",trigger:"=",drawn:"&"},link:function(n){n.clip=t.data.clip,n.typing=!1,void 0===n.showBounds&&(n.showBounds=!1),a.getMap().then(function(e){n.$watch("bounds",function(e){e&&n.trigger?r(function(){n.initiateDraw()}):e||t.cancelDraw()})}),e.$on("icsm.clip.draw",function(e,t){t&&"oversize"===t.message?(n.oversize=!0,r(function(){delete n.oversize},6e3)):delete n.oversize}),e.$on("icsm.clip.drawn",function(){return n.typing=!1}),n.initiateDraw=function(){i.info("Click on the map and drag to define your area of interest."),t.initiateDraw()},n.initiatePolygon=function(){i.info("Click on map for each vertex. Click on the first vertex to close the polygon.",6),t.initiatePolygon()}}}}]).directive("icsmManualClip",["$rootScope","clipService",function(i){return{restrict:"AE",templateUrl:"icsm/clip/manual.html",scope:{},link:function(n){function r(e){n.xMin=e.xMin,n.yMin=e.yMin,n.xMax=e.xMax,n.yMax=e.yMax}i.$on("icsm.polygon.drawn",function(e,t){return r(t)}),i.$on("icsm.clip.drawn",function(e,t){return r(t)}),n.allowSearch=function(){return!(isNan(n.xMin)||isNan(n.xMax)||isNan(n.yMin)||isNan(n.yMax)||+n.xMin==+n.xMax||+n.yMin==+n.yMax)},n.search=function(){var e=n.xMin,t=n.xMax;n.xMin=Math.min(e,t),n.xMax=Math.max(e,t),e=n.yMin,t=n.yMax,n.yMin=Math.min(e,t),n.yMax=Math.max(e,t),i.$broadcast("bounds.drawn",{bounds:L.latLngBounds(L.latLng(+n.yMin,+n.xMin),L.latLng(+n.yMax,+n.xMax))})}}}}]).factory("clipService",["$rootScope","drawService","parametersService",function(i,t,e){var a={data:{clip:{}},initiateDraw:function(){this.cancelDraw(),i.$broadcast("clip.initiate.draw",{started:!0});var e=this.data.clip;return delete e.xMin,delete e.xMax,delete e.yMin,delete e.yMax,delete e.area,delete e.type,delete e.polygon,t.drawRectangle({retryOnOversize:!1})},initiatePolygon:function(){this.cancelDraw(),i.$broadcast("clip.initiate.draw",{started:!0});var e=this.data.clip;return delete e.xMin,delete e.xMax,delete e.yMin,delete e.yMax,delete e.area,delete e.type,delete e.polygon,t.drawPolygon({retryOnOversize:!1})},cancelDraw:function(){t.cancelDraw()},setClip:function(e){return t=e,(n=a.data.clip).xMax=t.bounds.getEast().toFixed(5),n.xMin=t.bounds.getWest().toFixed(5),n.yMax=t.bounds.getNorth().toFixed(5),n.yMin=t.bounds.getSouth().toFixed(5),n.type="bbox",n.polygon="POLYGON(("+n.xMin+" "+n.yMin+","+n.xMin+" "+n.yMax+","+n.xMax+" "+n.yMax+","+n.xMax+" "+n.yMin+","+n.xMin+" "+n.yMin+"))",a.data.area=(n.xMax-n.xMin)*(n.yMax-n.yMin),a.data;var t,n}};i.$on("bounds.drawn",function(e,t){r(t)}),i.$on("polygon.drawn",function(e,t){i.$broadcast("icsm.poly.draw",t[0]);var n=a.data.clip,r=t[0];n.type="polygon",n.xMax=Math.max.apply(Math,_toConsumableArray(r.map(function(e){return e.lng}))),n.xMin=Math.min.apply(Math,_toConsumableArray(r.map(function(e){return e.lng}))),n.yMax=Math.max.apply(Math,_toConsumableArray(r.map(function(e){return e.lat}))),n.yMin=Math.min.apply(Math,_toConsumableArray(r.map(function(e){return e.lat}))),n.polygon="POLYGON(("+[].concat(_toConsumableArray(r),[r[0]]).map(function(e){return e.lng.toFixed(5)+" "+e.lat.toFixed(5)}).join(",")+"))",i.$broadcast("icsm.polygon.drawn",n)});var n=e.data;return n&&(r(n,!0),a.data.clip.type="bbox"),a;function r(e,t){console.log("data",e),a.setClip(e);var n=a.data.clip;i.$broadcast("icsm.bounds.draw",[n.xMin,n.yMin,n.xMax,n.yMax,!!t]),i.$broadcast("icsm.clip.drawn",n)}}]),angular.module("explorer.clip.modal",[]).directive("clipModal",["$document","$animate",function(r,e){return{restrict:"EA",transclude:!0,replace:!0,scope:{title:"@",isOpen:"=",showClose:"="},templateUrl:"icsm/clip/modal.html",link:function(t){function n(e){27===e.which&&(e.stopPropagation(),e.preventDefault(),t.$apply(function(){t.isOpen=!1}))}t.$watch("isOpen",function(e){e?r.on("keyup",n):r.off("keyup",n),t.$on("$destroy",function(){r.off("keyup",n)})})}}}]);var fileSize=function(e){return e?-1<(""+e).indexOf(" ")?e:(e=parseFloat(e))<1e3?e+" bytes":e<1e6?(e/1e3).toFixed(1)+" kB":e<1e9?(e/1e6).toFixed(1)+" MB":e<1e12?(e/1e9).toFixed(1)+" GB":(e/1e12).toFixed(1)+" TB":"-"};function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}angular.module("icsm.bounds",["icsm.message"]).directive("icsmBounds",["$rootScope","icsmMessageService","boundsService",function(e,t,n){return{restrict:"AE",link:function(){n.init().then(null,null,function(e){switch(t.removeFlash(),e.type){case"error":case"warn":case"info":t[e.type](e.text);break;case"wait":t.wait(e.text);break;default:t.flash(e.text,e.duration?e.duration:8e3,"wait"===e.type)}})}}}]).factory("boundsService",["$http","$q","$rootScope","$timeout","configService","flashService","messageService","parametersService",function(i,t,a,r,e,o,s,n){var l;return{init:function(){var e=t.defer();return n.hasValidBbox()&&(c("Checking for data ("+n.metadata+")..."),m(n.clip)),a.$on("icsm.clip.drawn",function(e,t){c("Area drawn. Checking for data..."),u(t).then(function(e){"success"===e.code&&m(t)})}),e.promise},cancelDraw:function(){drawService.cancelDraw()},checkSize:u};function c(e,t,n){o.remove(l),e&&("error"===t?s.error(e):l=o.add(e,n,!0))}function u(n){return t(function(e){var t=function(e){if(function(e){e.xMax=null===e.xMax?null:+e.xMax,e.xMin=null===e.xMin?null:+e.xMin,e.yMax=null===e.yMax?null:+e.yMax,e.yMin=null===e.yMin?null:+e.yMin}(e),p(e))return{code:"oversize"};if(d(e))return{code:"undersize"};if(null===e.xMax)return{code:"incomplete"};if(function(e){return e&&angular.isNumber(e.xMax)&&angular.isNumber(e.xMin)&&angular.isNumber(e.yMax)&&angular.isNumber(e.yMin)&&!p(e)&&!d(e)}(e))return{code:"success"};return{code:"invalid"}}(n);if(t&&t.code){switch(t.code){case"oversize":r(function(){c("","clear"),c("The selected area is too large to process. Please restrict to approximately 1.5 degrees square.","error")});break;case"undersize":r(function(){c("","clear"),c("X Min and Y Min should be smaller than X Max and Y Max, respectively. Please update the drawn area.","error")})}e(t)}})}function d(e){return(e.xMax-e.xMin)*(e.yMax-e.yMin)<1e-11||e.xMax<e.xMin}function p(e){return 2.25<Math.abs((e.xMax-e.xMin)*(e.yMax-e.yMin))}function m(r){e.getConfig("processing").then(function(e){var t,n=e.intersectsUrl;n&&(r.xMax.toFixed(5),r.xMin.toFixed(5),r.yMax.toFixed(5),r.yMin.toFixed(5),t=["polygon="+encodeURIComponent(r.polygon)],r.metadata&&t.push("metadata="+r.metadata),c("Checking there is data in your selected area...","wait",18e4),i.get(n+t.join("&")).then(function(e){var t;e.data&&e.data.available_data&&(t=!1,c("","clear"),e.data.available_data&&e.data.available_data.forEach(function(e){var n;e.downloadables&&(n=e.downloadables,Object.keys(n).forEach(function(e){var t=n[e];Object.keys(t).forEach(function(e){t[e].forEach(function(e){{var t;e.fileSize=fileSize(e.file_size),e.product&&(t=e.bbox.split(",").map(function(e){return+e}),e.bbox=[Math.max(t[0],r.xMin),Math.max(t[1],r.yMin),Math.min(t[2],r.xMax),Math.min(t[3],r.yMax)].join(","))}})})}),t=!0)}),t||c("There is no data held in your selected area. Please try another area.",null,4e3),a.$broadcast("site.selection",e.data))},function(e){c("The service that provides the list of datasets is currently unavailable. Please try again later.","error")}))})}}]),angular.module("icsm.elevation.point",[]).factory("elevationPointsService",["$http","$q","configService",function(n,e,r){return{getElevation:function(l){return e(function(o,s){r.getConfig("elevation").then(function(e){var t=_slicedToArray(l,2),n=t[0],r=t[1],i=[r-1e-6,n-1e-6,r+1e-6,n+1e-6],a=e.elevationTemplate.replace("{bbox}",i.join(","));(new TerrainLoader).load(a,function(e){o(e)},function(e){s(e)})})})},getHiResElevation:function(t){return r.getConfig("elevation").then(function(e){return n.get(e.hiResElevationTemplate.replace("{lng}",t.lng).replace("{lat}",t.lat))})}}}]);var GlossaryCtrl=function(e,t){var n=this;e.info("GlossaryCtrl"),t.getTerms().then(function(e){n.terms=e})},GlossaryService=function(e){return{getTerms:function(){return e.get("icsm/resources/config/glossary.json",{cache:!0}).then(function(e){return e.data})}}};angular.module("icsm.glossary",[]).directive("icsmGlossary",[function(){return{templateUrl:"icsm/glossary/glossary.html"}}]).controller("GlossaryCtrl",GlossaryCtrl).factory("glossaryService",GlossaryService),GlossaryCtrl.$inject=["$log","glossaryService"],GlossaryService.$inject=["$http"];var CoverageService=function(e,t){var r={show:!1};return{getState:function(){return r},toggle:function(){r.show=!r.show,r.layers||e.getConfig("map").then(function(e){r.layers=e.layers.filter(function(e){return e.coverage}),t.getMap().then(function(n){r.map=n,r.lookup=r.layers.reduce(function(e,t){return(e[t.name]=t).visible=n.hasLayer(t.layer),e},{})})})},toggleVisibility:function(e){e.visible=!e.visible,e.visible?e.layer?r.map.addLayer(e.layer):t.addLayer(e):e.layer.remove()},hide:function(){r.show=!1}}};angular.module("icsm.coverage",[]).directive("coverageToggle",["coverageService",function(t){return{templateUrl:"icsm/coverage/trigger.html",restrict:"AE",link:function(e){e.toggle=function(){t.toggle()}}}}]).directive("icsmCoverageLayersSelector",["$document","$timeout","coverageService",function(i,a,o){return{templateUrl:"icsm/coverage/popup.html",scope:{},link:function(t,n){function r(e){27===e.which&&(e.stopPropagation(),e.preventDefault(),t.$apply(function(){o.hide()}))}t.state=o.getState(),t.$watch("state.show",function(e){e?(i.on("keyup",r),a(function(){return n.find("button").focus()},50)):i.off("keyup",r),t.$on("$destroy",function(){i.off("keyup",r)})}),t.hide=function(){o.hide()},t.toggleVisibility=function(e){o.toggleVisibility(e)}}}}]).factory("coverageService",CoverageService),CoverageService.$inject=["configService","mapService"];var ContributorsService=function(e){var t={show:!1,ingroup:!1,stick:!1};return e.get("icsm/resources/config/contributors.json").then(function(e){t.orgs=e.data}),{getState:function(){return t}}};angular.module("icsm.contributors",[]).directive("icsmContributors",["$interval","contributorsService",function(r,i){return{templateUrl:"icsm/contributors/contributors.html",scope:{},link:function(e,t){var n;e.contributors=i.getState(),e.over=function(){r.cancel(n),e.contributors.ingroup=!0},e.out=function(){n=r(function(){e.contributors.ingroup=!1},1e3)},e.unstick=function(){e.contributors.ingroup=e.contributors.show=e.contributors.stick=!1,t.find("a").blur()}}}}]).directive("icsmContributorsLink",["$interval","contributorsService",function(n,r){return{restrict:"AE",templateUrl:"icsm/contributors/show.html",scope:{},link:function(e){var t;e.contributors=r.getState(),e.over=function(){n.cancel(t),e.contributors.show=!0},e.toggleStick=function(){e.contributors.stick=!e.contributors.stick,e.contributors.stick||(e.contributors.show=e.contributors.ingroup=!1)},e.out=function(){t=n(function(){e.contributors.show=!1},700)}}}}]).factory("contributorsService",ContributorsService).filter("activeContributors",function(){return function(e){return e?e.filter(function(e){return e.enabled}):[]}}),ContributorsService.$inject=["$http"],angular.module("icsm.header",[]).controller("headerController",["$scope","$q","$timeout",function(n,e,t){n.$on("headerUpdated",function(e,t){n.headerConfig=t})}]).directive("elvisHeader",[function(){var e={current:"none",heading:"ICSM",headingtitle:"ICSM",helpurl:"help.html",helptitle:"Get help about ICSM",helpalttext:"Get help about ICSM",skiptocontenttitle:"Skip to content",skiptocontent:"Skip to content",quicklinksurl:"/search/api/quickLinks/json?lang=en-US"};return{transclude:!0,restrict:"EA",templateUrl:"icsm/header/header.html",scope:{current:"=",breadcrumbs:"=",heading:"=",headingtitle:"=",helpurl:"=",helptitle:"=",helpalttext:"=",skiptocontenttitle:"=",skiptocontent:"=",quicklinksurl:"="},link:function(n){angular.copy(e);angular.forEach(e,function(e,t){t in n||(n[t]=e)})}}}]).factory("headerService",["$http",function(){}]);var HelpCtrl=function(e,t){var n=this;e.info("HelpCtrl"),t.getFaqs().then(function(e){n.faqs=e})},HelpService=function(e){return{getFaqs:function(){return e.get("icsm/resources/config/faqs.json",{cache:!0}).then(function(e){return e.data})}}};angular.module("icsm.help",[]).directive("icsmHelp",[function(){return{templateUrl:"icsm/help/help.html"}}]).directive("icsmFaqs",[function(){return{restrict:"AE",templateUrl:"icsm/help/faqs.html",scope:{faqs:"="},link:function(e){e.focus=function(e){$("#faqs_"+e).focus()}}}}]).controller("HelpCtrl",HelpCtrl).factory("helpService",HelpService),HelpCtrl.$inject=["$log","helpService"],HelpService.$inject=["$http"];var showButton=function(e){return e.file_url&&0<e.file_url.lastIndexOf(".zip")};angular.module("icsm.imagery",[]).directive("launchImage",["$rootScope","configService",function(r,t){return{templateUrl:"icsm/imagery/launch.html",restrict:"AE",link:function(e){var n=e.item;e.show=showButton(n),e.preview=function(){t.getConfig("imagery").then(function(e){var t=n.thumb_url;console.log(t,n),r.$broadcast("icsm-preview",{url:t,item:n})})}}}}]);var insidePolygon=function(e,t){for(var n=e.lat,r=e.lng,i=!1,a=0,o=t.length-1;a<t.length;o=a++){var s=t[a].lat,l=t[a].lng,c=t[o].lat,u=t[o].lng;r<l!=r<u&&n<(c-s)*(r-l)/(u-l)+s&&(i=!i)}return i};angular.module("icsm.layerswitch",[]).directive("icsmLayerswitch",["$http","configService","mapService",function(t,e,n){return{restrict:"AE",link:function(){var i,a;e.getConfig("layerSwitch").then(function(e){i=e,t.get(i.extentUrl,{cache:!0}).then(function(e){var t=L.geoJson(e.data).getLayers()[0];t&&(a=t.getLatLngs()),n.getMap().then(function(n){function e(e){var t=n.getBounds();insidePolygon({lng:t.getWest(),lat:t.getSouth()},a)&&insidePolygon({lng:t.getWest(),lat:t.getNorth()},a)&&insidePolygon({lng:t.getEast(),lat:t.getSouth()},a)&&insidePolygon({lng:t.getEast(),lat:t.getNorth()},a)?r({outside:!1,inside:!0}):r({outside:!0,inside:!1})}function r(t){n.eachLayer(function(e){e.options&&e.options.switch&&(e.options.switch===i.inside&&(e._container.style.display=t.inside?"block":"none"),e.options.switch===i.outside&&(e._container.style.display=t.outside?"block":"none"))})}n.on("moveend",e),e()})})})}}}]),angular.module("icsm.mapevents",["geo.map"]).directive("icsmMapevents",["icsmMapeventsService",function(e){return{restrict:"AE",link:function(){e.tickle()}}}]).factory("icsmMapeventsService",["$rootScope","$timeout","configService","mapService",function(i,a,e,o){var r,s,l,t=e.getConfig("mapConfig");function c(e,n){o.getMap().then(function(t){l&&t.removeLayer(l),e&&(l=L.geoJson(e,{style:function(){return{opacity:1,clickable:!1,fillOpacity:0,color:"red"}}}).addTo(t),n&&a(function(){var e=l.getBounds();t.fitBounds(e,{animate:!0,padding:L.point(100,100)})},50))})}function u(e,n){o.getMap().then(function(t){s&&t.removeLayer(s),e&&(s=L.geoJson(e,{style:function(){return{opacity:1,clickable:!1,fillOpacity:0,color:"black"}}}).addTo(t),n&&a(function(){var e=s.getBounds();t.fitBounds(e,{animate:!0,padding:L.point(100,100)})},50))})}return i.$on("icsm.bounds.draw",function(e,t){var n,r,i,a,o;t?(n=!1,r=t[2],i=t[0],a=t[3],o=t[1],4<t.length&&(n=t[4]),u({type:"Feature",geometry:{type:"Polygon",coordinates:[[[i,o],[r,o],[r,a],[i,a],[i,o]]]},properties:{}},n)):u(null)}),i.$on("icsm.bbox.draw",function(e,t){var n,r,i,a;t?(n=t[2],r=t[0],i=t[3],c({type:"Feature",geometry:{type:"Polygon",coordinates:[[[r,a=t[1]],[n,a],[n,i],[r,i],[r,a]]]},properties:{}},!1)):c(null)}),i.$on("icsm.poly.draw",function(e,t){var n,r;n=t,r=!0,o.getMap().then(function(t){s&&t.removeLayer(s),n&&(s=L.polygon(n,{opacity:1,clickable:!1,fillOpacity:0,color:"black"}).addTo(t),r&&a(function(){var e=s.getBounds();t.fitBounds(e,{animate:!0,padding:L.point(100,100)})},50))})}),t.listenForMarkerEvent&&i.$on(t.listenForMarkerEvent,function(e,t){var n;n=t,o.getMap().then(function(e){var t;r&&e.removeLayer(r),n&&(t=void 0!==n.properties.SAMPLE_LONGITUDE?{type:"Point",coordinates:[n.properties.SAMPLE_LONGITUDE,n.properties.SAMPLE_LATITUDE]}:n.geometry,r=L.geoJson({type:"Feature",geometry:t,id:n.id}).addTo(e),n.properties.html&&r.bindPopup(n.properties.html).openPopup())})}),{tickle:function(){o.getMap().then(function(r){r.on("click",function(e){var t=r.getZoom(),n=e.latlng;i.$broadcast("zoom.to",{zoom:t,latlng:n})})})}}}]),angular.module("icsm.message",[]).directive("icsmMessage",["icsmMessageService",function(t){return{templateUrl:"icsm/message/message.html",link:function(e){e.message=t.data}}}]).factory("icsmMessageService",["$timeout",function(n){var r={},i={get data(){return r},wait:function(e){return i.message("wait",e)},info:function(e){return i.message("info",e)},warn:function(e){return i.message("warn",e)},error:function(e){return i.message("error",e)},clear:function(){return i.message(null,null)},message:function(e,t){r.type=e,r.text=t,n(function(){i.removeFlash()},1e5)},flash:function(e){return i.message("flash",e)},removeFlash:function(){r.type=null}};return i}]);var PaneCtrl=function(e){var t=this;e.data().then(function(e){t.data=e})},PaneService=function(){return{add:function(){},remove:function(){}}};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}angular.module("icsm.panes",[]).directive("icsmPanes",["$rootScope","$timeout","mapService",function(i,a,o){return{templateUrl:"icsm/panes/panes.html",transclude:!0,scope:{defaultItem:"@",data:"="},controller:["$scope",function(n){var r=!1;i.$on("side.panel.change",function(e){function t(){var e=document.createEvent("HTMLEvents");e.initEvent("resize",!1,!0),window.dispatchEvent(e)}t(),a(t,100),a(t,200),a(t,300),a(t,500)}),n.view=n.defaultItem,i.$broadcast("view.changed",n.view,null),n.setView=function(e){var t=n.view;n.view===e?(e&&(r=!0),n.view=""):(e||(r=!0),n.view=e),i.$broadcast("view.changed",n.view,t),r&&o.getMap().then(function(e){e._onResize()})},a(function(){i.$broadcast("view.changed",n.view,null)},50)}]}}]).directive("icsmTabs",[function(){return{templateUrl:"icsm/panes/tabs.html",require:"^icsmPanes"}}]).controller("PaneCtrl",PaneCtrl).factory("paneService",PaneService),PaneCtrl.$inject=["paneService"],PaneService.$inject=[],angular.module("icsm.parameters",[]).factory("parametersService",["$location",function(e){return new(function(){function t(e){_classCallCheck(this,t),this.search=e}return _createClass(t,[{key:"ignoreSizeLimit",value:function(){return!!this.search.metadata}},{key:"hasValidBbox",value:function(){var e=this.search;return!(isNaN(e.minx)||isNaN(e.maxx)||isNaN(e.miny)||isNaN(e.maxy))}},{key:"clear",value:function(){this.search={}}},{key:"bbox",get:function(){return this.hasValidBbox()?{minx:+this.search.minx,maxx:+this.search.maxx,miny:+this.search.miny,maxy:+this.search.maxy}:null}},{key:"clip",get:function(){return this.hasValidBbox()?{xMin:+this.search.minx,xMax:+this.search.maxx,yMin:+this.search.miny,yMax:+this.search.maxy,metadata:this.search.metadata,polygon:this.polygon}:null}},{key:"bounds",get:function(){var e=this.search;return this.hasValidBbox()?L.latLngBounds([e.miny,e.minx],[e.maxy,e.maxx]):null}},{key:"polygon",get:function(){return"POLYGON(("+this.search.minx+" "+this.search.miny+","+this.search.minx+" "+this.search.maxy+","+this.search.maxx+" "+this.search.maxy+","+this.search.maxx+" "+this.search.miny+","+this.search.minx+" "+this.search.miny+"))"}},{key:"data",get:function(){return this.hasValidBbox()?{bounds:this.bounds,metadata:this.metadata,polygon:this.polygon}:null}},{key:"metadata",get:function(){return this.search.metadata}}]),t}())(e.search())}]),L.Control.ElevationControl=L.Control.extend({statics:{TITLE:"Find elevation at a point",ALT_TITLE:"Disable elevation at a point",CLASS_NAME:"leaflet-control-elevation",ALT_CLASS_NAME:"leaflet-control-alt-elevation"},options:{position:"topleft",handler:{}},toggle:function(){var e=this.options.handler,t=this.handleClick;e.enabled()?(this._map._container.style.cursor="",this._map.fire(L.Control.ElevationControl.Event.POINTEND,{}),this._map.off("click",t),this.link.title=L.Control.ElevationControl.TITLE,L.DomUtil.removeClass(this.link,L.Control.ElevationControl.ALT_CLASS_NAME),L.DomUtil.addClass(this.link,L.Control.ElevationControl.CLASS_NAME),e.disable()):(this._map.fire(L.Control.ElevationControl.Event.POINTSTART,{}),this._map._container.style.cursor="crosshair",this._map.on("click",t),this.link.title=L.Control.ElevationControl.ALT_TITLE,L.DomUtil.removeClass(this.link,L.Control.ElevationControl.CLASS_NAME),L.DomUtil.addClass(this.link,L.Control.ElevationControl.ALT_CLASS_NAME),e.enable())},onAdd:function(e){var t=this,n=L.Control.ElevationControl.CLASS_NAME;this._container=L.DomUtil.create("div","leaflet-bar");var r,i=this.link=L.DomUtil.create("a",n,this._container);return i.href="#",i.title=L.Control.ElevationControl.TITLE,L.DomEvent.addListener(i,"click",L.DomEvent.stopPropagation).addListener(i,"click",L.DomEvent.preventDefault).addListener(i,"click",this.toggle,this),e.on("draw:drawstart",function(){t.clear()}),this.clear=function(){this.options.handler.enabled()&&this.toggle()},this.handleClick=(r=this.options.handler,function(e){r.searching(e.latlng)}),this._container}}),L.Map.mergeOptions({elevationControl:!1}),L.Control.elevationControl=function(e){return new L.Control.ElevationControl(e)},L.Control.ElevationControl.Event={POINTSTART:"point:start",POINTEND:"point:end"},angular.module("icsm.point",[]).directive("pointElevation",["elevationPointsService","flashService","mapService",function(e,m,n){return{restrict:"AE",link:function(d){var p=null;n.getMap().then(function(e){d.map=e,L.Control.ElevationControl.ALT_TITLE="Find features around a point",d.control=L.Control.elevationControl({handler:t}).addTo(e),console.log("Point signing in")});var t={disable:function(){d.enabled=!1,console.log("Disable elevation handler here"),m.remove(p),map.closePopup(),p=m.add("Click map for datasets surrounding a point.",4e3)},enable:function(){d.enabled=!0,d.$apply(function(){m.remove(p),p=m.add("Click map for detailed elevation information at point",4e3)})},enabled:function(){return d.enabled},searching:function(c){function u(e){return"<strong>"+e+":</strong> "}m.remove(p),d.elevation=d.error=null,p=m.add("Retrieving elevation data",2e4,!0),e.getHiResElevation(c).then(function(e){var t=e.data,n=d.map;m.remove(p);var r,i,a=t["HEIGHT AT LOCATION"],o=[],s=c.lat.toFixed(5)+"&deg;",l=c.lng.toFixed(5)+"&deg;";"m"===a||void 0===a||"No data"===a?(o.push(u("Lat/Lng")+s+"/"+l),o.push("<strong>No data available at this point</strong>")):(o.push(u("Elevation")+a),o.push(u("Lat/Lng")+s+"/"+l),o.push(u("Source")+t.SOURCE),o.push(u("Dataset")+"<span class='elevation-popup ellipsis' title='"+t.DATASET+"'>"+(r=t.DATASET,(i=t["METADATA URL"])?"<a href='"+i+"' target='_blank'>"+r+"</a>":r)+"</span>"),o.push(u("DEM Resolution")+t["DEM RESOLUTION"])),L.popup({maxWidth:400}).setLatLng(c).setContent("<div class='fi-popup'>"+o.join("<br/>")+"</div>").openOn(n),d.elevation=t}).catch(function(e){m.remove(p),d.error="No data available at this point"})}}}}}]);fileSize=function(e){return e?-1<(""+e).indexOf(" ")?e:(e=parseFloat(e))<1e3?e+" bytes":e<1e6?(e/1e3).toFixed(1)+" kB":e<1e9?(e/1e6).toFixed(1)+" MB":e<1e12?(e/1e9).toFixed(1)+" GB":(e/1e12).toFixed(1)+" TB":"-"};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}angular.module("icsm.polygon",["icsm.message"]).directive("icsmPolygon",["$rootScope","icsmMessageService","polygonService",function(e,t,n){return{restrict:"AE",link:function(){n.init().then(null,null,function(e){switch(t.removeFlash(),e.type){case"error":case"warn":case"info":t[e.type](e.text);break;case"wait":t.wait(e.text);break;default:t.flash(e.text,e.duration?e.duration:8e3,"wait"===e.type)}})}}}]).factory("polygonService",["$http","$q","$rootScope","$timeout","configService","flashService","messageService",function(o,r,s,i,n,a,l){var c;return{init:function(){return r(function(e,t){s.$on("icsm.polygon.drawn",function(e,t){u("Area drawn. Checking for data..."),d(t).then(function(e){function i(n){Object.keys(n).forEach(function(e){var t=n[e];Object.keys(t).forEach(function(e){t[e].forEach(function(e){{var t;e.fileSize=fileSize(e.file_size),e.product&&(t=e.bbox.split(",").map(function(e){return+e}),e.bbox=[Math.max(t[0],a.xMin),Math.max(t[1],a.yMin),Math.min(t[2],a.xMax),Math.min(t[3],a.yMax)].join(","))}})})})}var a;"success"===e.code&&(a=t,n.getConfig("processing").then(function(e){var t,n,r=e.intersectsUrl;r&&(t=a.polygon,n=["polygon="+encodeURIComponent(t)],a.metadata&&n.push("metadata="+a.metadata),u("Checking there is data in your selected area...","wait",18e4),o.get(r+n.join("&")).then(function(e){var t;e.data&&e.data.available_data&&(t=!1,u("","clear"),e.data.available_data&&e.data.available_data.forEach(function(e){e.downloadables&&(i(e.downloadables),t=!0)}),t||u("There is no data held in your selected area. Please try another area.",null,4e3),s.$broadcast("site.selection",e.data))},function(e){u("The service that provides the list of datasets is currently unavailable. Please try again later.","error")}))}))})})})},cancelDraw:function(){drawService.cancelDraw()},checkSize:d};function u(e,t,n){a.remove(c),e&&("error"===t?l.error(e):c=a.add(e,n,!0))}function d(e){var t=r.defer(),n=function(e){if(m(e))return{code:"oversize"};if(p(e))return{code:"undersize"};if(null===e.xMax)return{code:"incomplete"};if(function(e){return e&&angular.isNumber(e.xMax)&&angular.isNumber(e.xMin)&&angular.isNumber(e.yMax)&&angular.isNumber(e.yMin)&&!m(e)&&!p(e)}(e))return{code:"success"};return{code:"invalid"}}(e);if(n&&n.code)switch(n.code){case"oversize":i(function(){u("","clear"),u("The selected polygon's bounds exceeds the practical search size. Please confine your polygon within a bounds of approximately 1.5 degrees square.","error"),t.resolve(n)});break;case"undersize":i(function(){u("","clear"),u("X Min and Y Min should be smaller than X Max and Y Max, respectively. Please update the drawn area.","error"),t.resolve(n)});break;default:return r.when(n)}return t.promise}function p(e){return(e.xMax-e.xMin)*(e.yMax-e.yMin)<1e-11||e.xMax<e.xMin}function m(e){return 2.25<Math.abs((e.xMax-e.xMin)*(e.yMax-e.yMin))}}]),angular.module("icsm.preview",[]).directive("previewImage",["$rootScope",function(e){return{templateUrl:"icsm/preview/preview.html",restrict:"AE",link:function(n){n.clear=function(){n.previewData=null},e.$on("icsm-preview",function(e,t){n.previewData=t})}}}]).factory("previewService",[function(){return new(function(){function t(e){_classCallCheck(this,t),this.search=e}return _createClass(t,[{key:"ignoreSizeLimit",value:function(){return!!this.search.metadata}},{key:"hasValidBbox",value:function(){var e=this.search;return!(isNaN(e.minx)||isNaN(e.maxx)||isNaN(e.miny)||isNaN(e.maxy))}},{key:"clear",value:function(){this.search={}}},{key:"bbox",get:function(){return this.hasValidBbox()?{minx:+this.search.minx,maxx:+this.search.maxx,miny:+this.search.miny,maxy:+this.search.maxy}:null}},{key:"clip",get:function(){return this.hasValidBbox()?{xMin:+this.search.minx,xMax:+this.search.maxx,yMin:+this.search.miny,yMax:+this.search.maxy,metadata:this.search.metadata}:null}},{key:"bounds",get:function(){var e=this.search;return this.hasValidBbox()?L.latLngBounds([e.miny,e.minx],[e.maxy,e.maxx]):null}},{key:"data",get:function(){return this.hasValidBbox()?{bounds:this.bounds,metadata:this.metadata}:null}},{key:"metadata",get:function(){return this.search.metadata}}]),t}())($location.search())}]);var validClip=function(e){var t=isFinite(e.yMax)&&isFinite(e.xMax)&&isFinite(e.yMin)&&isFinite(e.xMin);return t=(t=t&&e.yMax<90&&-90<e.yMin&&e.xMax<=180&&-180<=e.xMin)&&e.yMax>e.yMin&&e.xMax>e.xMin},DownloadService=function(n,t){var r="download_email",i={weight:2,opacity:.9,fill:!1,color:"#000000",width:3,clickable:!1};return{showClip:function(e){this.removeClip(e.layer);var t=[[e.yMin,e.xMin],[e.yMax,e.xMax]];e.layer=n.createBounds(t,i),n.showLayer(e.layer)},removeClip:function(e){e&&n.hideLayer(e)},setEmail:function(e){t.setItem(r,e)},getEmail:function(){return t.getItem(r).then(function(e){return e})},submit:function(e,t){var n=e;angular.forEach(t,function(e,t){n=n.replace("${"+t+"}",e)}),$("#launcher")[0].src=n}}},validSize=function(e,t){var n=1<arguments.length&&void 0!==t?t:16;return e&&angular.isNumber(e.xMax)&&angular.isNumber(e.xMin)&&angular.isNumber(e.yMax)&&angular.isNumber(e.yMin)&&!overSizeLimit(e,n)&&!underSizeLimit(e)},underSizeLimit=function(e){return(e.xMax-e.xMin)*(e.yMax-e.yMin)<1e-11||e.xMax<e.xMin},overSizeLimit=function(e,t){var n=Math.abs((e.xMax-e.xMin)*(e.yMax-e.yMin));return t&&t<n},constrainBounds=function(e,t){var n=!1,r=!1;return!(!t||i(e.xMax)||i(e.xMin)||i(e.yMax)||i(e.yMin))&&(r=n=+e.xMax<+t.xMin,n&&(e.xMax=+t.xMin),n=+e.xMax>+t.xMax,r=r||n,n&&(e.xMax=+t.xMax),n=+e.xMin<+t.xMin,r=r||n,n&&(e.xMin=+t.xMin),n=+e.xMin>+e.xMax,r=r||n,n&&(e.xMin=e.xMax),n=+e.yMax<+t.yMin,r=r||n,n&&(e.yMax=+t.yMin),n=+e.yMax>+t.yMax,r=r||n,n&&(e.yMax=+t.yMax),n=+e.yMin<+t.yMin,r=r||n,n&&(e.yMin=+t.yMin),n=+e.yMin>+e.yMax,r=r||n,n&&(e.yMin=+e.yMax),r);function i(e){return angular.isUndefined(e)||""===e||null===e}};angular.module("product.download",[]).directive("productDownloadButton",["configService",function(e){return{template:"<button ng-click='item.showDownload = !item.showDownload' type='button' class='undecorated' title='Click to start download'><i class='fa fa-lg fa-download' ng-class='{active:item.showDownload}'></i></button>",scope:{item:"="},link:function(){console.log("What's up item!")}}}]).directive("productDownloadPanel",["$rootScope","productDownloadService","flashService",function(e,r,t){return{templateUrl:"icsm/products/download.html",scope:{item:"="},link:function(n){n.processing={clip:{},get valid(){return this.validClipSize&&this.validEmail},get validClip(){return validClip(this.clip)},get validClipSize(){return validClip(this.clip)&&validSize(this.clip,n.item.restrictSize)},get validEmail(){return this.email},get validProjection(){return this.outCoordSys},get validFormat(){return this.outFormat},get percentComplete(){return(this.validClip?25:0)+(this.validEmail?25:0)+(this.validProjection?25:0)+(this.validFormat?25:0)}},n.item.processing=n.processing,n.drawn=function(){return draw()},e.$on("icsm.clip.drawn",function(e,t){n.processing.clip={xMax:t.xMax,xMin:t.xMin,yMax:t.yMax,yMin:t.yMin},n.processing.message="",n.processing.validClip?(constrainBounds(n.processing.clip,n.item.bounds)&&(n.processing.message="Bounds restricted to fit within product's extent"),validSize(n.processing.clip,n.item.restrictSize)||(n.processing.message="That exceeds the area you can clip for this dataset. Restrict to "+n.item.restrictSize+" square degrees.")):n.processing.message="That is not a valid area for this dataset"}),n.$watch("item.showDownload",function(e,t){e&&!n.processing.email&&r.getEmail().then(function(e){n.processing.email=e})})}}}]).directive("productDownloadSubmit",["configService","productDownloadService","messageService",function(e,n,r){return{templateUrl:"icsm/products/submit.html",scope:{item:"=",processing:"="},link:function(t){t.submit=function(){var e=t.processing;n.setEmail(e.email),n.submit(t.item.template,{id:t.item.primaryId,yMin:e.clip.yMin,yMax:e.clip.yMax,xMin:e.clip.xMin,xMax:e.clip.xMax,outFormat:e.outFormat.code,outCoordSys:e.outCoordSys.code,email:e.email,filename:""}),r.success("Submitted your job. An email will be delivered on completion.")}}}}]).factory("productDownloadService",DownloadService),DownloadService.$invoke=["productsMapUtilsService","persistService"];var intersecting=function(e,t){return t&&e&&angular.isNumber(t.xMin)&&angular.isNumber(t.xMax)&&angular.isNumber(t.yMin)&&angular.isNumber(t.yMax)?e.filter(function(e){return!e.extent||e.extent.xMin<=t.xMin&&e.extent.xMax>=t.xMax&&e.extent.yMin<=t.yMin&&e.extent.yMax>=t.yMax}):e};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}angular.module("icsm.product",["product.download"]).directive("productProjection",["productsConfigService",function(e){return{templateUrl:"icsm/products/projection.html",scope:{processing:"="},link:function(t){e.config.then(function(e){t.config=e})}}}]).directive("productFormats",["productsConfigService",function(e){return{templateUrl:"icsm/products/formats.html",scope:{processing:"="},link:function(t){e.config.then(function(e){t.config=e}),console.log("What's up doc!")}}}]).directive("productEmail",[function(){return{templateUrl:"icsm/products/email.html",scope:{processing:"="}}}]).filter("productIntersect",function(){return intersecting}),angular.module("icsm.products",["icsm.product"]).provider("productsConfigService",[function(){var t="icsm/resources/config/download.json";this.setLocation=function(e){t=e},this.$get=["$http",function(e){return new DownloadConfig(t,e)}]}]);var DownloadConfig=function(){function n(e,t){_classCallCheck(this,n),this.$http=t,this.location=e}return _createClass(n,[{key:"child",value:function(t){return this.config.then(function(e){return e[t]})}},{key:"initiateServiceTemplates",get:function(){return child("initiateServiceTemplates")}},{key:"processingTemplates",get:function(){return this.child("processing")}},{key:"outputFormat",get:function(){return this.child("outFormat")}},{key:"defaultOutputFormat",get:function(){return this.outputFormat.then(function(e){return e.find(function(e){return e.default})})}},{key:"defaultOutputCoordinateSystem",get:function(){return this.outputCoordinateSystem.then(function(e){return e.find(function(e){return e.default})})}},{key:"outputCoordinateSystem",get:function(){return this.child("outCoordSys")}},{key:"datasets",get:function(){return this.child("datasets")}},{key:"config",get:function(){return this.$http.get(this.location,{cache:!0}).then(function(e){return e.data})}}]),n}();angular.module("elvis.results.continue",[]).directive("icsmSearchContinue",["configService","continueService",function(e,n){return{templateUrl:"icsm/results/continue.html",controller:"listCtrl",controllerAs:"ctrl",link:function(t){e.getConfig("downloadLimit").then(function(e){t.limit=e}),t.data=n.data}}}]).factory("continueService",["listService",function(e){var t={};return t.data=e.data,t}]).filter("someSelected",function(){return function(e){return e&&e.some(function(e){return e.selected})}}).filter("countSelected",function(){return function(e){return e?e.filter(function(e){return e.selected}).length:""}});var fileSize=function(e){return e?-1<(""+e).indexOf(" ")?e:(e=parseFloat(e))<1e3?e+" bytes":e<1e6?(e/1e3).toFixed(1)+" kB":e<1e9?(e/1e6).toFixed(1)+" MB":e<1e12?(e/1e9).toFixed(1)+" GB":(e/1e12).toFixed(1)+" TB":"-"},ListCtrl=function(e){this.service=e,this.checkChildren=function(e){var t=this.childrenChecked(e),n=e;t||(n=e.filter(function(e){return e.matched})),n.forEach(function(e){t?delete e.selected:e.selected=!0})},this.childrenChecked=function(e){return!e.filter(function(e){return e.matched}).some(function(e){return!e.selected})},this.someMatches=function(e){var t=!1;return angular.forEach(e.downloadables,function(e){angular.forEach(e,function(e){t|=e.some(function(e){return e.matched})})}),t},this.someChildMatches=function(e){var t=!1;return angular.forEach(group,function(e){t|=e.some(function(e){return e.matched})}),t},this.review=function(){this.service.data.reviewing=!0},this.cancelReview=function(){this.service.data.reviewing=!1}};angular.module("elvis.results",["elvis.results.continue","icsm.subtype","icsm.unreleased"]).directive("productsDialog",["productsConfigService","listService",function(n,r){return{restrict:"AE",link:function(e){var t=e.processing=r.data;n.defaultOutputCoordinateSystem.then(function(e){return t.outCoordSys=e}),n.defaultOutputFormat.then(function(e){return t.outFormat=e})}}}]).directive("icsmOrgHeading",[function(){return{templateUrl:"icsm/results/orgheading.html",restrict:"AE",scope:{org:"=",mappings:"="},link:function(n){n.heading=function(){var e=n.org.source,t=n.mappings[e];return t.displayName?t.displayName:e}}}}]).directive("icsmList",["$rootScope","listService",function(r,a){return{templateUrl:"icsm/results/results.html",link:function(i){function n(e){return angular.isArray(e)||!e?e:e.split(/,\s*/g).map(function(e){return+e})}a.getMappings().then(function(e){i.mappings=e}),i.filters=a.data,i.update=function(){var n,e,t=!!i.filters.filter,r=i.filters.types.some(function(e){return e.selected})&&!i.filters.types.every(function(e){return e.selected});i.products.forEach(function(e){e.matched=!t}),r&&i.products.forEach(function(t){t.matched=!1,i.filters.types.filter(function(e){return e.selected}).forEach(function(e){(e.match&&e.match[t.type]||e.noMatch&&!e.noMatch[t.type])&&(t.matched=!0)})}),t&&(n=i.filters.filter.toUpperCase(),e=i.products,r&&(e=e.filter(function(e){return e.matched})),e.forEach(function(e){var t=e.file_name||e.project_name||"";e.matched=-1<t.toUpperCase().indexOf(n)})),i.$broadcast("filter.changed")},i.show=function(e){var t=n(e.bbox);r.$broadcast("icsm.bbox.draw",t)},i.hide=function(e){r.$broadcast("icsm.bbox.draw",null)},r.$on("clip.initiate.draw",function(e,t){i.list=null,i.products=[],i.productsMap=[]}),r.$on("site.selection",function(e,t){i.list=null,i.products=[],i.productsMap=[],t.available_data&&(i.list=t.available_data.filter(function(e){return e.downloadables}),i.list.forEach(function(r){angular.forEach(r.downloadables,function(e,n){angular.forEach(e,function(e,t){e.forEach(function(e){e.source=r.source,e.group=t,e.type=n,i.productsMap[e.file_url]=e,i.products.push(e)})})})}),a.products=i.products),i.update()}),i.show=function(e){var t=n(e.bbox);r.$broadcast("icsm.bbox.draw",t)},i.hide=function(e){r.$broadcast("icsm.bbox.draw",null)}}}}]).directive("icsmAbstract",["listService",function(e){return{templateUrl:"icsm/results/abstractbutton.html",scope:{item:"="},link:function(t){t.show=e.hasMetadata(t.item),t.toggle=function(){t.item.showAbstract=!t.item.showAbstract,t.item.showAbstract&&(t.fetched||(t.fetched=!0,e.getMetadata(t.item).then(function(e){t.item.metadata=e})))}}}}]).directive("icsmAbstractHover",["$timeout","listService",function(i,a){return{restrict:"AE",scope:{item:"="},link:function(t,e){var n;function r(){t.fetched||(t.fetched=!0,a.getMetadata(t.item).then(function(e){t.item.metadata=e}))}e.on("mouseenter",function(){n&&i.cancel(n),n=i(r,250)}),e.on("mouseleave",function(){n&&(i.cancel(n),n=null)})}}}]).directive("icsmAbstractLink",["$timeout","listService",function(e,n){return{restrict:"AE",template:"<a target='_blank' ng-if='url' ng-href='{{url}}'>{{item[name]}}</a><span ng-if='!url' ng-bind='item.file_name'></span>",scope:{item:"=",name:"@?"},link:function(e){e.name||(e.name="file_name");var t={file_name:e.item[e.name],metadata_url:e.item.metadata_url,source:e.item.source};e.url=n.getLink(t)}}}]).controller("listCtrl",ListCtrl).factory("listService",["$http","$rootScope",function(e,t){var n={},r=new Strategies(e);return n.data={id:"listService_data",filter:"",types:[]},t.$on("icsm.clip.drawn",function(e,t){return n.data.clip=t}),e.get("icsm/resources/config/filetypes.json").then(function(e){n.data.typesMap=e.data,n.data.types=[],angular.forEach(e.data,function(e,t){n.data.types.push(e)})}),n.getMetadata=function(e){return r.strategy(e.source).requestMetadata(e)},n.hasMetadata=function(e){return r.strategy(e.source).hasMetadata(e)},n.getLink=function(e){return r.strategy(e.source).constructLink(e)},n.getMappings=function(){return e.get("icsm/resources/config/list.json").then(function(e){return e.data})},n}]).filter("allowedTypes",["listService",function(r){return function(e){if(!r.data.types.some(function(e){return e.selected}))return e;var n={};return angular.forEach(e,function(e,t){r.data.typesMap&&r.data.typesMap[t]&&r.data.typesMap[t].selected&&(n[t]=e)}),n}}]).filter("countMatchedDownloadables",function(){return function(e){if(e){var n=0;return angular.forEach(e,function(e,t){Array.isArray(e)||angular.forEach(e,function(e){n+=e.filter(function(e){return e.matched}).length})}),n}return"-"}}).filter("countMatchedItems",function(){return function(e){return e?e.filter(function(e){return e.matched}).length:""}}).filter("hasTypeMatches",function(){return function(t){if(!t)return!1;var n=0;return Object.keys(t).forEach(function(e){n+=t[e].filter(function(e){return e.matched}).length}),0<n}}).filter("matchedTypes",function(){return function(e){var n={};return angular.forEach(e,function(e,t){e.some(function(e){return e.matched})&&(n[t]=e)}),n}}).filter("matchedGroups",[function(){return function(e){var n={};return e&&angular.forEach(e,function(e,t){e.some(function(e){return e.matched})&&(n[t]=e)}),n}}]).filter("matchedItems",function(){return function(e){return e.filter(function(e){return e.matched})}}).filter("keysLength",[function(){return function(n){return n?Object.keys(n).reduce(function(e,t){return e+n[t].length},0):0}}]).filter("countDownloadables",function(){return function(e){if(e){var n=0;return angular.forEach(e,function(e,t){angular.forEach(e,function(e,t){n+=e.length})}),n}return"-"}}).filter("fileSize",function(){return fileSize}),ListCtrl.$inject=["listService"],ListCtrl.prototype={get products(){return this.service.products},get selectedSize(){var e=this.service.products;return(e?e.filter(function(e){return e.selected&&!e.removed}):[]).map(function(e){return e.file_size?+e.file_size:5e8}).reduce(function(e,t){return e+t},0)},get selected(){var e=this.service.products;return e?e.filter(function(e){return e.selected&&!e.removed}):[]}};var toNumberArray=function(e){return angular.isArray(e)||!e?e:e.split(/,\s*/g).map(function(e){return+e})};angular.module("icsm.subtype",["bw.paging"]).directive("subtype",["$rootScope",function(n){return{templateUrl:"icsm/results/subtype.html",scope:{items:"=",mappings:"="},link:function(r){r.paging={page:1,pageSize:20},r.$on("filter.changed",function(){console.log("Filter changed - Subtype"),r.setPage(1,20)}),r.setPage=function(e,t){var n=r.items.filter(function(e){return e.matched});r.data=n.slice(t*(e-1),e*t)},r.setPage(1,20),r.show=function(e){var t=toNumberArray(e.bbox);n.$broadcast("icsm.bbox.draw",t)},r.hide=function(e){n.$broadcast("icsm.bbox.draw",null)}}}}]).filter("hasProducts",function(){return function(e){return e.some(function(e){return e.product})}}).filter("hasTransformables",function(){return function(e){return e.some(function(e){return e.transformable})}}).filter("productsSummary",function(){return function(e){var t=e.filter(function(e){return e.product}).length,n=" including ";switch(t){case 1:n+="1 product";break;default:n+=t+" products"}return n}}).filter("productsCount",function(){return function(e){return e?e.filter(function(e){return e.product}).length:0}}).filter("transformablesCount",function(){return function(e){return e?e.filter(function(e){return e.transformable}).length:0}});var captured=function(e){if(!e)return e;var t=e.split(" - ");return 2!==t.length?e:formatDate(t[0])+" - "+formatDate(t[1])},formatDate=function(e){return 8!==e.length?e:e.substr(0,4)+"/"+e.substr(4,2)+"/"+e.substr(6,2)},toNumberArray=function(e){return angular.isArray(e)||!e?e:e.split(/,\s*/g).map(function(e){return+e})};angular.module("icsm.unreleased",[]).directive("icsmUnreleased",["$rootScope",function(n){return{templateUrl:"icsm/results/unreleased.html",scope:{types:"="},link:function(e){console.log("Unrelease me!"),e.show=function(e){var t=toNumberArray(e.bbox);n.$broadcast("icsm.bbox.draw",t)},e.hide=function(e){n.$broadcast("icsm.bbox.draw",null)}}}}]).directive("icsmProjectAbstract",["listService",function(e){return{templateUrl:"icsm/results/abstractbutton.html",scope:{project:"="},link:function(t){t.item={},t.show=e.hasMetadata(t.item),t.toggle=function(){t.item.showAbstract=!t.item.showAbstract,t.item.showAbstract&&(t.fetched||(t.fetched=!0,e.getMetadata(t.item).then(function(e){t.item.metadata=e})))}}}}]).filter("captured",function(){return captured}).filter("reverseDate",function(){return formatDate});var SelectService=function(e,t,n,r,i){var o,l={text:"",daterange:{enabled:!1,upper:null,lower:null},bbox:{fromMap:!0,intersects:!0,yMax:null,yMin:null,xMax:null,xMin:null},defaultKeywords:[],keywords:[]},s={},a="#ff7800",c={getSelectCriteria:function(){return l},getLayerGroup:function(){return o=o||i.getGroup("Search Layers")},setKeywords:function(){},setFilter:function(){},refresh:function(){},getDaterange:function(){return l.daterange},more:function(){},_executeQuery:function(){e.get("icsm/resources/config/select.json",{cache:!0}).then(function(e){c.getLayerGroup();var t=e.data;t.response.docs.forEach(function(e){c._decorateDataset(e),"group"==e.type&&e.docs.forEach(function(e){c._decorateDataset(e)})}),n.$broadcast("select.facet.counts",t),n.$broadcast("select.results.received",t)})},createLayer:function(e){var t,n,r=e.bbox,i=e.primaryId,a=s[i];if(!a){if(!r)return null;if(4!=(t=r.split(" ")).length)return null;n=[[+t[1],+t[0]],[+t[3],+t[2]]],a=L.rectangle(n,{fill:!1,color:"#000000",width:3,clickable:!1}),s[i]=a}return this._decorateDataset(e),o.addLayer(a),a},_decorateDataset:function(e){var t,n,r=s[e.primaryId];r?(e.layer=r,e.showLayer=!0):(e.layer=null,e.showLayer=!1,e.services=servicesFactory(e.dcUris),e.bounds=(t=e.bbox)?{xMin:+(n=t.split(/\s/g))[0],xMax:+n[2],yMax:+n[3],yMin:+n[1]}:null)},showWithin:function(e){e.forEach(function(e){var t,n,r,i,a,o,s=e.bbox;s&&4===(t=s.split(" ")).length&&(n=+t[0],r=+t[1],i=+t[2],a=+t[3],n>(o=l.bbox).xMin&&i<o.xMax&&r>o.yMin&&a<o.yMax)?c.createLayer(e):c.removeLayer(e)})},toggle:function(e){e.showLayer?this.removeLayer(e):this.createLayer(e)},toggleAll:function(e){var t=this,n=e.some(function(e){return!e.showLayer});return e.forEach(function(e){n?e.showLayer||t.createLayer(e):e.showLayer&&t.removeLayer(e)}),!n},hideAll:function(e){e.forEach(function(e){e.showLayer&&c.removeLayer(e)})},hilight:function(e){e.setStyle({color:"darkblue"})},lolight:function(e){e.setStyle({color:a})},removeLayer:function(e){var t=e.primaryId,n=s[t];n&&(o.removeLayer(n),delete s[t]),this._decorateDataset(e)}};return r(function(){c._executeQuery()},100),c},servicesFactory=function(e){var n={WCS:"OGC:WCS",WFS:"OGC:WFS",WMS:"OGC:WMS"};function r(e){var t=$(e);this.protocol=t.attr("protocol"),this.url=t.text(),this.layerNames=t.attr("layerNames"),this.name=t.attr("name"),this.description=t.attr("description"),this.handlers=[],this.isWcs=function(){return this.protocol==n.WCS},this.isWfs=function(){return this.protocol==n.WFS},this.isWms=function(){return this.protocol==n.WMS},this.isSupported=function(){return void 0===n[this.protocol]},this.addHandler=function(e){this.handlers.push(e)},this.removeHandler=function(e){this.handlers.push(e)},this.remove=function(){this.handlers.forEach(function(e){this.callback.remove&&e.remove(this)}.bind(this)),this.handlers=[]}}return r.prototype={getUrl:function(){return url?url.indexOf("?")<0?void 0:url.substr(0,url.indexOf("?")):null}},new function(e){this.uris=e,this.container={wcs:null,wms:null},this.services=e?e.map(function(e){var t=new r(e);return this.container.wcs=t.isWcs()?t:this.container.wcs,this.container.wms=t.isWms()?t:this.container.wms,t}.bind(this)):[],this.hasWcs=function(){return null!==this.container.wcs},this.hasWms=function(){return null!==this.container.wms},this.getWcs=function(){return this.container.wcs},this.getWms=function(){return this.container.wms},this.remove=function(){this.services.forEach(function(e){e.remove()})}}(e)};angular.module("icsm.select.service",[]).factory("selectService",SelectService),SelectService.$inject=["$http","$q","$rootScope","$timeout","mapService","configService"];var SelectCriteriaCtrl=function(e){this.criteria=e.getSelectCriteria(),this.refresh=function(){e.refresh()}},SelectCtrl=function(e,t,n,r){var i,a=this;e.$on("select.results.received",function(e,t){n.remove(i),a.data=t}),t.getConfig("facets").then(function(e){this.hasKeywords=e&&e.keywordMapped&&0<e.keywordMapped.length}.bind(this)),this.select=function(){n.remove(i),i=n.add("Selecting",3e3,!0),r.setFilter(this.filter)},this.toggle=function(e){r.toggle(e)},this.toggleAll=function(){r.toggleAll(this.data.response.docs)},this.showWithin=function(){r.showWithin(this.data.response.docs)},this.allShowing=function(){return!(!this.data||!this.data.response)&&!this.data.response.docs.some(function(e){return!e.showLayer})},this.anyShowing=function(){return!(!this.data||!this.data.response)&&this.data.response.docs.some(function(e){return e.showLayer})},this.hideAll=function(){r.hideAll(this.data.response.docs)},this.hilight=function(e){e.layer&&r.hilight(e.layer)},this.lolight=function(e){e.layer&&r.lolight(e.layer)}};angular.module("icsm.select",["icsm.select.service"]).controller("SelectCtrl",SelectCtrl).controller("SelectCriteriaCtrl",SelectCriteriaCtrl).directive("icsmSelect",[function(){return{templateUrl:"icsm/select/select.html",link:function(){}}}]).directive("selectDoc",[function(){return{templateUrl:"icsm/select/doc.html",link:function(){}}}]).directive("selectGroup",[function(){return{templateUrl:"icsm/select/group.html",scope:{group:"="},link:function(){}}}]).filter("pubDate",function(){return function(e){var t;return e?(t=new Date(e)).getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear():"-"}}).filter("authors",function(){return function(e){return e?e.join(", "):"-"}}).filter("truncate",function(){return function(e,t){return e&&e.length>t-3?e.substr(0,t-3)+"...":e}}),SelectCriteriaCtrl.$inject=["selectService"],SelectCtrl.$inject=["$rootScope","configService","flashService","selectService"];var transformTemplate=function(e,t){var n=e;return angular.forEach(t,function(e,t){n=n.replace("{"+t+"}",encodeURIComponent(e))}),n},convertFlatToStructured=function(e){var a=["file_url","file_name","project_name","product","metadata_id","file_size","bbox"],t={available_data:[]},o=t.available_data,s={};return e.forEach(function(t){var n={};a.forEach(function(e){void 0!==t[e]&&(n[e]=t[e])});var e=s[t.source];e||(e={source:t.source,downloadables:{}},s[t.source]=e,o.push(e));var r=e.downloadables[t.type];r||(r={},e.downloadables[t.type]=r);var i=r[t.group];i||(i=[],r[t.group]=i),i.push(n)}),t};function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(n){var r=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(n);return _possibleConstructorReturn(this,r?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=_superPropBase(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}angular.module("elvis.reviewing",[]).directive("icsmReview",["$rootScope","$uibModal","$log","messageService","reviewService",function(e,t,n,r,i){return{link:function(o){o.data=i.data,o.$watch("data",function(e,t){t&&(console.log("Why?",e),o.data=i.data)}),o.$watch("data.reviewing",function(e){e&&t.open({templateUrl:"icsm/reviewing/reviewing.html",size:"lg",backdrop:"static",keyboard:!1,controller:["$scope","$uibModalInstance","listService","products","vcRecaptchaService",function(n,e,t,r,i){n.recaptchaKey="6LfUrFsUAAAAAKu4EJY_FSi3zFXvWm60RDVknRHf";var a=o.selected=r.filter(function(e){return e.selected});o.derived=a.filter(function(e){return e.product}),t.getMappings().then(function(e){n.mappings=e}),n.heading=function(e){var t=n.mappings[e];return t.displayName?t.displayName:e},n.products=convertFlatToStructured(a).available_data,n.accept=function(){e.close(n.recaptchaResponse,n.products)},n.cancel=function(){e.close(null)},n.setWidgetId=function(e){n.recaptchaId=e},n.setResponse=function(e){n.recaptchaResponse=e},n.cbExpiration=function(){i.reload(n.recaptchaId),n.recaptchaResponse=null}}],resolve:{products:function(){return i.products}}}).result.then(function(e){delete o.data.recaptchaResponse,e&&(o.data.recaptchaResponse=e,i.startExtract().then(function(e){r[e.status](e.message),i.removeRemoved(),o.data.reviewing=!1})),i.removeRemoved(),o.data.reviewing=!1},function(){n.info("Cancelled")})})}}}]).directive("reviewIndustry",["configService","reviewService",function(e,n){return{retrict:"AE",template:'<div class="input-group"><span class="input-group-addon" style="width:6em" id="nedf-industry">Industry</span><select required="required" type="text" ng-options="ind.text for ind in industries" ng-model="data.industry" class="form-control" placeholder="Industry of interest for this data" aria-describedby="nedf-industry"></select></div>',link:function(t){t.data=n.data,e.getConfig("industries").then(function(e){t.industries=e})}}}]).directive("reviewEmail",["reviewService",function(t){return{template:'<div class="input-group"><span class="input-group-addon" style="width:6em" id="nedf-email">Email</span><input required="required" type="email" ng-model="data.email" class="form-control" placeholder="Email address to send download link" aria-describedby="nedf-email"></div>',restrict:"AE",link:function(e){e.data=t.data}}}]).filter("reviewProductsSelected",function(){return function(e){return e.filter(function(e){return e.selected})}}).filter("reviewSumSize",function(){return function(e){return e.reduce(function(e,t){return e+(t.file_size?+t.file_size:t.product?5e8:0)},0)}}).factory("reviewService",["$http","$q","clipService","configService","listService","persistService",function(r,e,i,n,a,t){var o="elvis_download_email",s="elvis_download_industry",l=a.data,c={get data(){return l},set data(e){console.log("What the hell!")},get products(){return a.products},startExtract:function(){return this.setEmail(l.email),this.setIndustry(l.industry),n.getConfig("processing").then(function(t){var n=i.data.clip;return console.log("We are processing files"),function(){var e=convertFlatToStructured(a.products.filter(function(e){return e.selected}));e.parameters={polygon:n.polygon,email:l.email,industry:l.industry.code,recaptcha:l.recaptchaResponse},l.outCoordSys&&(e.parameters.outCoordSys=l.outCoordSys.code);l.outFormat&&(e.parameters.outFormat=l.outFormat.code);return a.products.forEach(function(e){e.selected=e.removed=!1}),r({method:"POST",url:t.postProcessingUrl,data:e,headers:{"Content-Type":"application/json"}}).then(function(e){return e.data},function(e){return{status:"error",message:"Sorry but the service failed to respond. Try again later."}})}()})},removeRemoved:function(){a.products.forEach(function(e){e.removed=!1})},setEmail:function(e){this.data.email=e,t.setItem(o,e)},setIndustry:function(e){(this.data.industry=e)&&e.code&&t.setItem(s,e.code)},clipProduct:function(){}};return t.getItem(o).then(function(e){c.data.email=e}),t.getItem(s).then(function(t){t&&n.getConfig("industries").then(function(e){c.data.industry=e.find(function(e){return e.code===t})})}),c}]),angular.module("icsm.splash",[]).directive("icsmSplash",["$rootScope","$uibModal","$log","splashService",function(e,n,r,i){return{controller:["$scope","splashService",function(t,n){t.acceptedTerms=!0,n.getReleaseNotes().then(function(e){t.releaseMessages=e,t.acceptedTerms=n.hasViewedSplash()})}],link:function(t){t.$watch("acceptedTerms",function(e){!1===e&&n.open({templateUrl:"icsm/splash/splash.html",size:"lg",backdrop:"static",keyboard:!1,controller:["$scope","$uibModalInstance","acceptedTerms","messages",function(e,t,n,r){e.acceptedTerms=n,e.messages=r,e.accept=function(){t.close(!0)}}],resolve:{acceptedTerms:function(){return t.acceptedTerms},messages:function(){return t.releaseMessages}}}).result.then(function(e){r.info("Accepted terms"),t.acceptedTerms=e,i.setHasViewedSplash(e)},function(){r.info("Modal dismissed at: "+new Date)})}),e.$on("logoutRequest",function(){userService.setAcceptedTerms(!1)})}}}]).factory("splashService",["$http",function(e){var t="icsm.accepted.terms";return{getReleaseNotes:function(){return e({method:"GET",url:"icsm/resources/service/releaseNotes?t="+Date.now()}).then(function(e){return e.data})},hasViewedSplash:function(){return!!sessionStorage.getItem(t)},setHasViewedSplash:function(e){e?sessionStorage.setItem(t,!0):sessionStorage.removeItem(t)}}}]).filter("priorityColor",[function(){var t={IMPORTANT:"red",HIGH:"blue",MEDIUM:"orange",LOW:"gray"};return function(e){return e in t?t[e]:"black"}}]).filter("wordLowerCamel",function(){return function(e){return e.charAt(0)+e.substr(1).toLowerCase()}}).filter("sortNotes",[function(){return function(e){if(e)return e.slice(0).sort(function(e,t){return e.priority==t.priority?e.lastUpdate==t.lastUpdate?0:t.lastUpdate-e.lastUpdate:"IMPORTANT"==e.priority?-11:1})}}]),angular.module("icsm.state",[]).directive("icsmStateToggle",["downloadService",function(e){return{restrict:"AE",template:'<button ng-click="toggle(false)" ng-disabled="state.show" class="btn btn-default" title="Start downlaod selection."><i class="fa fa-lg fa-object-group"></i></button>',link:function(t){e.data().then(function(e){t.state=e}),t.toggle=function(){t.state.show=!t.state.show}}}}]);var BaseStrategy=function(){function o(e){_classCallCheck(this,o),this.http=e,this.NO_METADATA="Metadata"}return _createClass(o,[{key:"constructLink",value:function(e){return e.metadata_url?e.metadata_url:null}},{key:"hasMetadata",value:function(){return!1}},{key:"requestMetadata",value:function(){return o.resolvedPromise({title:this.NO_METADATA})}}],[{key:"resolvedPromise",value:function(e){var t={then:function(e){this.fn=e}};return setTimeout(function(){t.fn&&t.fn(e)},1),t}},{key:"extractData",value:function(e){var t,n=e.MD_Metadata,r={},i=n&&n.identificationInfo&&n.identificationInfo.MD_DataIdentification,a=i;return(i=(i=i&&i.citation&&i.citation.CI_Citation)&&i.title&&i.title.CharacterString)?(r.title=i.__text,t=a&&a.abstract&&a.abstract.CharacterString&&a.abstract.CharacterString.__text,r.abstract=r.abstractText=t):r.title=_get(_getPrototypeOf(o),"NO_METADATA",this),r}}]),o}(),UnknownStrategy=function(){_inherits(n,BaseStrategy);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return n}(),ActStrategy=function(){_inherits(n,BaseStrategy);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return n}(),GaStrategy=function(){_inherits(r,BaseStrategy);var n=_createSuper(r);function r(e){var t;return _classCallCheck(this,r),(t=n.call(this,e)).GA_LINK_METADATA_TEMPLATE="https://ecat.ga.gov.au/geonetwork/srv/eng/search#!${uuid}",t.GA_METADATA_TEMPLATE="https://ecat.ga.gov.au/geonetwork/srv/eng/xml.metadata.get?uuid=${uuid}",t.UUID_REG_EX=/[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}/,t}return _createClass(r,[{key:"constructLink",value:function(e){if(e.metadata_url)return e.metadata_url;var t=e.metadata_id;return t?this.GA_LINK_METADATA_TEMPLATE.replace("${uuid}",t):null}},{key:"hasMetadata",value:function(e){return!!this.constructLink(e)}},{key:"requestMetadata",value:function(e){var t=this,n=e.metadata_id,r=n?"xml2js/"+this.GA_METADATA_TEMPLATE.replace("${uuid}",n):null;return r?this.http.get(r).then(function(e){return BaseStrategy.extractData(e.data)},function(e){return{title:t.NO_METADATA}}):BaseStrategy.resolvedPromise({title:this.NO_METADATA})}}]),r}(),EftfStrategy=function(){_inherits(n,BaseStrategy);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"constructLink",value:function(e){return e.metadata_url}},{key:"requestMetadata",value:function(){return BaseStrategy.resolvedPromise({title:"View metadata in new page"})}}]),n}(),NswStrategy=function(){_inherits(o,BaseStrategy);var n=_createSuper(o);function o(e){var t;return _classCallCheck(this,o),(t=n.call(this,e)).NSW_METADATA_TEMPLATE="https://s3-ap-southeast-2.amazonaws.com/nsw.elvis/z5${zone}/Metadata/",t}return _createClass(o,[{key:"constructLink",value:function(e){var t=e.file_name,n=t.search(/\_5\d\_/),r=6,i=this.NSW_METADATA_TEMPLATE;return-1!==n&&(r=t.substr(n+2,1)),i.replace("${zone}",r)+t.replace(".zip","_Metadata.html")}},{key:"hasMetadata",value:function(){return!0}},{key:"requestMetadata",value:function(e){var t=this,n=e.file_name,r=n.search(/\_5\d\_/),i=6,a=this.NSW_METADATA_TEMPLATE;return-1!==r&&(i=n.substr(r+2,1)),a="xml2js/"+a.replace("${zone}",i)+n.replace(".zip","_Metadata.xml"),this.http.get(a).then(function(e){return BaseStrategy.extractData(e.data)},function(e){return{title:_get(_getPrototypeOf(o.prototype),"NO_METADATA",t)}})}}]),o}(),NtStrategy=function(){_inherits(n,BaseStrategy);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return n}(),QldStrategy=function(){_inherits(i,BaseStrategy);var n=_createSuper(i);function i(e){var t;return _classCallCheck(this,i),(t=n.call(this,e)).XML_METADATA_TEMPLATE="http://qldspatial.information.qld.gov.au/catalogue/rest/document?id={metadata_id}&f=xml",t.QLD_METADATA_TEMPLATE="http://qldspatial.information.qld.gov.au/catalogue/rest/document?id={EB442CAB-D714-40D8-82C2-A01CA4661324}&f=xml",t.QLD_HTML_TEMPLATE="http://qldspatial.information.qld.gov.au/catalogue/custom/detail.page?fid={EB442CAB-D714-40D8-82C2-A01CA4661324}",t.FRASER_COAST_METADATA_TEMPLATE="http://qldspatial.information.qld.gov.au/catalogue/rest/document?id={E8CEF5BA-A1B7-4DE5-A703-8161FD9BD3CF}&f=xml",t.FRASER_COAST_HTML_TEMPLATE="http://qldspatial.information.qld.gov.au/catalogue/custom/detail.page?fid={E8CEF5BA-A1B7-4DE5-A703-8161FD9BD3CF}",t.FRASER_COAST_BOUNDS=[152.331,-26.003,153.37,-24.692],t}return _createClass(i,[{key:"constructLink",value:function(e){if(e.metadata_url)return e.metadata_url;var t=e.bbox.split(",").map(function(e){return parseFloat(e.trim())});return t[0]>=this.FRASER_COAST_BOUNDS[0]&&t[1]>=this.FRASER_COAST_BOUNDS[1]&&t[2]<=this.FRASER_COAST_BOUNDS[2]&&t[0]>=this.FRASER_COAST_BOUNDS[3]?this.FRASER_COAST_HTML_TEMPLATE:this.QLD_HTML_TEMPLATE}},{key:"hasMetadata",value:function(){return!0}},{key:"requestMetadata",value:function(e){var t,n,r=this;return e.metadata_id?t=this.XML_METADATA_TEMPLATE.replace("metadata_id",e.metadata_id):(t=this.QLD_METADATA_TEMPLATE,(n=e.bbox.split(",").map(function(e){return parseFloat(e.trim())}))[0]>=this.FRASER_COAST_BOUNDS[0]&&n[1]>=this.FRASER_COAST_BOUNDS[1]&&n[2]<=this.FRASER_COAST_BOUNDS[2]&&n[0]>=this.FRASER_COAST_BOUNDS[3]&&(t=this.FRASER_COAST_METADATA_TEMPLATE)),this.http.get("xml2js/"+t).then(function(e){return BaseStrategy.extractData(e.data)},function(e){return{title:_get(_getPrototypeOf(i.prototype),"NO_METADATA",r)}})}}]),i}(),SaStrategy=function(){_inherits(n,BaseStrategy);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return n}(),TasStrategy=function(){_inherits(n,BaseStrategy);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return n}(),VicStrategy=function(){_inherits(n,BaseStrategy);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return n}(),WaStrategy=function(){_inherits(n,BaseStrategy);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return n}(),Strategies=function(){function n(e){_classCallCheck(this,n);var t=this.unknown=new UnknownStrategy;this.strategies={"NSW Government":new NswStrategy(e),"VIC Government":t,"SA Government":t,"WA Government":t,"QLD Government":new QldStrategy(e),"ACT Government":t,"NT Government":t,"TAS Government":t,"Geoscience Australia":new GaStrategy(e),"Exploring for the Future":new EftfStrategy(e)}}return _createClass(n,[{key:"strategy",value:function(e){var t=this.strategies[e];return t||this.unknown}}]),n}();angular.module("icsm.themes",[]).directive("icsmThemes",["themesService",function(n){return{restrict:"AE",templateUrl:"icsm/themes/themes.html",link:function(t){n.getThemes().then(function(e){t.themes=e}),n.getCurrentTheme().then(function(e){t.theme=e}),t.changeTheme=function(e){t.theme=e,n.setTheme(e.key)}}}}]).controller("themesCtrl",["themesService",function(e){this.service=e}]).filter("themesFilter",function(){return function(e,t){var n=[];return t?(e&&e.forEach(function(e){e.themes&&e.themes.some(function(e){return e==t.key})&&n.push(e)}),n):e}}).factory("themesService",["$q","configService","storageService",function(t,e,n){var r="icsm.current.theme",i=[],a=this;return this.themes=[],this.theme=null,n.getItem(r).then(function(t){t=t||"All",e.getConfig("themes").then(function(e){a.themes=e,a.theme=e[t],angular.forEach(e,function(e,t){e.key=t}),i.forEach(function(e){e.resolve(a.theme)})})}),this.getCurrentTheme=function(){if(this.theme)return t.when(a.theme);var e=t.defer();return i.push(e),e.promise},this.getThemes=function(){return e.getConfig("themes")},this.setTheme=function(e){this.theme=this.themes[e],n.setItem(r,e)},this}]),angular.module("icsm.toolbar",[]).directive("elevationToolbar",[function(){return{restrict:"AE",templateUrl:"icsm/toolbar/toolbar.html",controller:"toolbarLinksCtrl",transclude:!0}}]).controller("toolbarLinksCtrl",["$scope","configService",function(t,e){var n=this;e.getConfig().then(function(e){n.links=e.toolbarLinks}),t.item="",t.toggleItem=function(e){t.item=t.item===e?"":e}}]);var DownloadCtrl=function(t){t.data().then(function(e){this.data=e}.bind(this)),this.remove=function(){t.clear()},this.changeEmail=function(e){t.setEmail(e)}},DownloadService=function(e,t,n,r,i){var a="download_email",o="Download Layers",s={zoom:null,center:null,layer:null},l=null,c={getLayerGroup:function(){return r.getGroup(o)},setState:function(e){e?function(){e.bounds.yMin,e.bounds.xMin,e.bounds.yMax,e.bounds.xMax;s.layer&&r.getGroup(o).removeLayer(s.layer)}():s.layer&&(r.clearGroup(o),s.layer=null)},decorate:function(){var e=l.item;l.item.download=!0,e.processsing||(e.processing={clip:{xMax:null,xMin:null,yMax:null,yMin:null}})},setEmail:function(e){i.setItem(a,e)},getEmail:function(){return i.getItem(a).then(function(e){return l.email=e})},data:function(){return l?t.when(l):e.get("icsm/resources/config/icsm.json").then(function(e){return l=e.data,c.decorate(),l})}};return c};angular.module("icsm.view",[]).directive("icsmView",["downloadService",function(n){return{templateUrl:"icsm/view/view.html",controller:"DownloadCtrl",link:function(t){n.data().then(function(e){t.data=e}),t.$watch("data.item",function(e,t){(e||t)&&n.setState(e)})}}}]).controller("DownloadCtrl",DownloadCtrl).factory("downloadService",DownloadService),DownloadCtrl.$inject=["downloadService"],DownloadService.$inject=["$http","$q","$rootScope","mapService","storageService"],angular.module("icsm.transect",[]).provider("transectService",function(){var a,w={},o={lngMin:112.99986111100009,lngMax:153.999861113351,latMin:-44.0001389004617,latMax:-10.00013890099995};this.extent=function(e){o.lngMin=angular.isUndefined(e.lngMin)?o.lngMin:e.lngMin,o.lngMax=angular.isUndefined(e.lngMax)?o.lngMax:e.lngMax,o.latMin=angular.isUndefined(e.latMin)?o.latMin:e.latMin,o.latMax=angular.isUndefined(e.latMax)?o.latMax:e.latMax},this.setServiceUrl=function(e,t){e=e.toLowerCase(),w[e]={urlTemplate:t},"elevation"===e&&(a=t.replace(/{height}|{width}/g,"1"))},this.$get=["$q",function(d){return{getElevation:function(e,t){return this.getServiceData("elevation",e,t)},getServiceData:function(t,e,n){var p=Exp.Util.toGeoJSONFeature(e),r=turf.extent(p),m={type:"FeatureCollection",features:[]},f=r[0],i=r[1],a=r[2],g=r[3];if(t=t.toLowerCase(),!(u=w[t]&&w[t].urlTemplate))return d.when(m);var h=(a=f<a?a:f+1e-4)-f,v=(g=i<g?g:i+1e-4)-i;i-=(n=n||0)*v,g+=n*v,f-=n*h,a+=n*h;var o,s,l,y=(o=500,s=h/v,l=Math.sqrt(o*o/(1+s*s)),{y:Math.ceil(l),x:Math.ceil(l*s)}),b=turf.lineDistance(p,"kilometers"),c=new TerrainLoader,x=d.defer(),u=u.replace("{bbox}",f+","+i+","+a+","+g).replace(/{width}/g,""+Math.ceil(y.x)).replace(/{height}/g,""+Math.ceil(y.y));return c.load(u,function(e){for(var t,n,r,i,a,o,s=b/499,l=0;l<500;l++){var c=l*s,u=turf.along(p,c,"kilometers"),d=(t=u.geometry.coordinates,0,n=t[0],r=t[1],i=f,a=Math.round((g-r)/v*(y.y-1)),o=Math.round((n-i)/h*(y.x-1)),e[a*y.x+o]);u.properties.distance=c,-32767<d&&(u.geometry.coordinates.push(d),m.features.push(u))}x.resolve(m)},function(e){console.log("Failed to load transect data for "+t),x.reject(e)}),x.promise},isServiceDataAvailable:function(e){return w[e]&&w[e].urlTemplate},getElevationAtPoint:function(e){var t=e.lng,n=e.lat;if(n<o.latMin||n>o.latMax||t<o.lngMin||t>o.lngMax)return d.when(null);var r=[t-1e-6,n-1e-6,t+1e-6,n+1e-6],i=d.defer();return(new TerrainLoader).load(a.replace("{bbox}",r.join(",")),function(e){i.resolve(e)},function(e){console.log("Error, probably out of bounds")}),i.promise}}}]}),angular.module("icsm.templates",[]).run(["$templateCache",function(e){e.put("icsm/app/app.html",'<div>\r\n\t\x3c!-- BEGIN: Sticky Header --\x3e\r\n\t<div explorer-header style="z-index:1"\r\n\t\t\tclass="navbar navbar-default navbar-fixed-top"\r\n\t\t\theading="\'Elevation\'"\r\n\t\t\theadingtitle="\'ICSM\'"\r\n\t\t\tbreadcrumbs="[{name:\'ICSM\', title: \'Reload Elevation\', url: \'.\'}]"\r\n\t\t\thelptitle="\'Get help about Elevation\'"\r\n\t\t\thelpalttext="\'Get help about Elevation\'">\r\n\t</div>\r\n\t\x3c!-- END: Sticky Header --\x3e\r\n\r\n\t\x3c!-- Messages go here. They are fixed to the tab bar. --\x3e\r\n\t<div explorer-messages class="marsMessages noPrint"></div>\r\n\t<icsm-panes data="root.data" default-item="download"></icsm-panes>\r\n</div>'),e.put("icsm/clip/clip.html",'<div class="well well-sm">\r\n   <div class="container-fluid">\r\n      <div class="row">\r\n         <div class="col-md-10">\r\n            <strong style="font-size:120%">Select area by:</strong>\r\n            <button ng-click="initiateDraw()" style="position:relative" ng-disable="client.drawing" tooltip-placement="right"\r\n               uib-tooltip="Drawing a bounding box. On enabling, click on the map and drag diagonally"\r\n               class="clip-btn">\r\n               <img style="height:24px;" src="icsm/resources/img/draw_rectangle.png"></img>\r\n               <div></div>\r\n            </button>\r\n            <button ng-click="initiatePolygon()" style="position:relative" ng-disable="client.drawing" tooltip-placement="right"\r\n               uib-tooltip="Drawing a polygon. On enabling, click vertices on the map, click on the first vertex to complete the loop."\r\n               class="clip-btn">\r\n               <img style="height:26px;" src="icsm/resources/img/draw_polygon.png"></img>\r\n               <div></div>\r\n            </button>\r\n            <button ng-click="typing = !typing" style="position:relative" tooltip-placement="right"\r\n               uib-tooltip="Type coordinates of a bounding box. Restricted to maximum of 2.25 square degrees."\r\n               class="clip-btn">\r\n               <i class="fa fa-keyboard-o fa-2x" aria-hidden="true"></i>\r\n               <div></div>\r\n            </button>\r\n         </div>\r\n         <div class="col-md-2">\r\n            <button style="float:right" ng-click="showInfo = !showInfo" tooltip-placement="left"\r\n               uib-tooltip="Information." class="btn btn-primary btn-default"><i class="fa fa-info"></i></button>\r\n            <exp-info title="Selecting an area" show-close="true"\r\n               style="width:450px;position:fixed;top:230px;right:40px" is-open="showInfo">\r\n               <icsm-info-bbox>\r\n         </div>\r\n         </exp-info>\r\n      </div>\r\n   </div>\r\n   <div class="row" ng-hide="typing || (!clip.xMin && clip.xMin !== 0) || oversize" style="padding-top:7px;">\r\n         <div class="col-md-12 ng-binding" ng-if="clip.type == \'polygon\'">\r\n            Polygon bounded by:\r\n            {{clip.xMin | number : 4}} west,\r\n            {{clip.yMax | number : 4}} north,\r\n            {{clip.xMax | number : 4}} east,\r\n            {{clip.yMin | number : 4}} south\r\n         </div>\r\n         <div class="col-md-12 ng-binding" ng-if="clip.type == \'bbox\'">\r\n            Selected bounds:\r\n            {{clip.xMin | number : 4}} west,\r\n            {{clip.yMax | number : 4}} north,\r\n            {{clip.xMax | number : 4}} east,\r\n            {{clip.yMin | number : 4}} south\r\n         </div>\r\n   </div>\r\n   <clip-modal title="Define search area" show-close="true" style="width:480px;position:fixed;top:110px;right:80px"\r\n      is-open="typing">\r\n      <icsm-manual-clip></icsm-manual-clip>\r\n   </clip-modal>\r\n</div>'),e.put("icsm/clip/infobbox.html",'<div class="">\r\n\t<strong style="font-size:120%">Select an area of interest.</strong>\r\n   By hitting one of the "Draw" buttons an area on the map can be selected with the mouse by drawing a bounding box, drawing a polygon or manually typing in the minimum and maximum of latitude and longitude. Hover over the buttons to see\r\n\tmore information.\r\n\t<br/>\r\n   Clicking one of the "Draw" buttons again allows replacing a previous area selection. <br/>\r\n   <strong>Notes:</strong>\r\n   <ul>\r\n      <li>The data does not cover all of Australia.</li>\r\n      <li>Restrict a search area to below 1.5 degrees square. eg 2x0.75 or 1x1.5</li>\r\n   </ul>\r\n\t<p style="padding-top:5px"><strong>Hint:</strong> If the map has focus, you can use the arrow keys to pan the map.\r\n\t\tYou can zoom in and out using the mouse wheel or the "+" and "-" map control on the top left of the map. If you\r\n\t\tdon\'t like the position of your drawn area, hit the one of the "Draw" buttons to draw a new search area.\r\n\t</p>\r\n</div>'),e.put("icsm/clip/manual.html",'<div class="container-fluid" style="padding-top:7px">\r\n   <div class="row">\r\n      <div class="col-md-3"> </div>\r\n      <div class="col-md-8">\r\n         <div style="font-weight:bold;width:3.5em;display:inline-block">Y Max:</div>\r\n         <span>\r\n            <input type="text" style="width:6em" ng-model="yMax" ng-change="check()"></input>\r\n         </span>\r\n      </div>\r\n   </div>\r\n   <div class="row">\r\n      <div class="col-md-6">\r\n         <div style="font-weight:bold;width:3.5em;display:inline-block">X Min:</div>\r\n         <span>\r\n            <input type="text" style="width:6em" ng-model="xMin" ng-change="check()"></input>\r\n         </span>\r\n      </div>\r\n      <div class="col-md-6">\r\n         <div style="font-weight:bold;width:3.5em;display:inline-block">X Max:</div>\r\n         <span>\r\n            <input type="text" style="width:6em" ng-model="xMax" ng-change="check()"></input>\r\n         </span>\r\n      </div>\r\n   </div>\r\n   <div class="row">\r\n      <div class="col-md-offset-3 col-md-5">\r\n         <div style="font-weight:bold;width:3.5em;display:inline-block">Y Min:</div>\r\n         <span>\r\n            <input type="text" style="width:6em" ng-model="yMin" ng-change="check()"></input>\r\n         </span>\r\n      </div>\r\n      <div class="col-md-4">\r\n         <button style="float:right" ng-disabled="!xMin || !xMax || !yMin || !yMax || isNan(xMin) || isNan(xMax) || isNan(yMin) || isNan(yMax) || (+xMin) === (+xMax) || (+yMin) === (+yMax)" class="btn btn-primary btn-default" ng-click="search()">Search</button>\r\n      </div>\r\n   </div>\r\n</div>'),e.put("icsm/clip/modal.html",'<div class="clipmodal" ng-show="isOpen">\r\n\t<div class="clipmodal-inner">\r\n      <h3 ng-show="title" class="clipmodal-title">\r\n\t\t  \t<span  ng-bind="title"></span>\r\n\t\t  \t<span ng-show="showClose" class="pull-right">\r\n\t\t \t\t<button type="button" class="undecorated" ng-click="isOpen = false"><i class="fa fa-close"></i></button>\r\n\t\t\t</span>\r\n\t\t</h3>\r\n      <div class="clipmodal-content" ng-transclude></div>\r\n\t</div>\r\n</div>'),e.put("icsm/glossary/glossary.html",'<div ng-controller="GlossaryCtrl as glossary">\r\n   <div style="position:relative;padding:5px;padding-left:10px;">\r\n      <div class="panel" style="padding:5px;">\r\n         <p style="text-align: left; margin: 10px; font-size: 14px;">\r\n\t         <strong>Glossary</strong>\r\n         </p>\r\n\r\n         <div class="panel-body">\r\n            <table class="table table-striped">\r\n               <thead>\r\n                  <tr>\r\n                     <th>Term</th>\r\n                     <th>Definition</th>\r\n                  </tr>\r\n               </thead>\r\n               <tbody>\r\n                  <tr ng-repeat="term in glossary.terms">\r\n                     <td>{{term.term}}</td>\r\n                     <td>{{term.definition}}</td>\r\n                  </tr>\r\n               </tbody>\r\n            </table>\r\n         </div>\r\n      </div>\r\n   </div>\r\n</div>'),e.put("icsm/coverage/popup.html",'<span class="coverage" ng-class="state.show ? \'transitioned-down\' : \'transitioned-up\'">\r\n   <div style="padding-bottom:15px" class="coverage-off">\r\n      <button class="undecorated coverage-unstick" ng-click="hide()" style="float:right" title="Hide layer selections">X</button>\r\n   </div>\r\n   <div ng-repeat="layer in state.layers" class="coverage-layer" tooltip-placement="left"\r\n         uib-tooltip="Hint: To bring this layer to the top turn it off then on. The last clicked layer is always on top.">\r\n      <input type="checkbox" ng-checked="layer.visible" ng-click="toggleVisibility(layer)"></input>\r\n      <span ng-click="toggleVisibility(layer)">\r\n         <span class="coverage-title">{{layer.name}}</span><br/>\r\n         <img style="width:100px" ng-src="{{layer.coverage.thumb}}"></img>\r\n      </span>\r\n      <div class="pull-right">\r\n         <div style="width: 110px" ng-repeat="type in layer.coverage.types">\r\n            <span class="coverage-legend-color" ng-style="{\'background-color\':type.color}"></span>\r\n            {{type.name}}\r\n         </div>\r\n      </div>\r\n   </div>\r\n</span>'),e.put("icsm/coverage/trigger.html",'<button ng-click="toggle()" type="button" class="map-tool-toggle-btn" title="Select views of coverage, view legends and summaries of the coverage layers">\r\n      <span class="panel-sm">Layers</span>\r\n      <img src="icsm/resources/img/layers-16.png">\r\n</button>'),e.put("icsm/contributors/contributors.html",'<span class="contributors" ng-mouseenter="over()" ng-mouseleave="out()"\r\n      ng-class="(contributors.show || contributors.ingroup || contributors.stick) ? \'transitioned-down\' : \'transitioned-up\'">\r\n   <button class="undecorated contributors-unstick" ng-click="unstick()" style="float:right">X</button>\r\n   <div ng-repeat="contributor in contributors.orgs | activeContributors" style="text-align:center">\r\n      <a ng-href="{{contributor.href}}" name="contributors{{$index}}" title="{{contributor.title}}" target="_blank">\r\n         <img ng-src="{{contributor.image}}" alt="{{contributor.title}}" class="contributor-logo" ng-class="contributor.class"></img>\r\n      </a>\r\n   </div>\r\n</span>'),e.put("icsm/contributors/show.html",'<a ng-mouseenter="over()" ng-mouseleave="out()" class="contributors-link" title="Click to lock/unlock contributors list."\r\n      ng-click="toggleStick()" href="#contributors0">Contributors</a>'),e.put("icsm/header/header.html",'<div class="container-full common-header" style="padding-right:10px; padding-left:10px">\r\n   <div class="navbar-collapse collapse ga-header-collapse">\r\n      <ul class="nav navbar-nav">\r\n         <li class="hidden-xs">\r\n            <a href="https://www.icsm.gov.au/" target="_blank" class="icsm-logo"\r\n               style="margin-top: -4px;display:inline-block;">\r\n               <img alt="ICSM - ANZLIC Committee on Surveying &amp; Mapping" class="header-logo"\r\n                  src="icsm/resources/img/icsm-logo-sml.gif">\r\n            </a>\r\n            <a href="/">\r\n               <h1 class="applicationTitle">{{heading}}</h1>\r\n            </a>\r\n         </li>\r\n      </ul>\r\n      <ul class="nav navbar-nav navbar-right nav-icons">\r\n         <li role="menuitem" style="padding-right:10px;position: relative;top: -3px;">\r\n            <span class="altthemes-container">\r\n               <span>\r\n                  <a title="Location INformation Knowledge platform (LINK)" href="http://fsdf.org.au/" target="_blank">\r\n                     <img alt="FSDF" src="icsm/resources/img/FSDFimagev4.0.png" style="height: 66px">\r\n                  </a>\r\n               </span>\r\n            </span>\r\n         </li>\r\n         <li common-navigation role="menuitem" current="current" style="padding-right:10px"></li>\r\n         <li mars-version-display role="menuitem"></li>\r\n         <li style="width:10px"></li>\r\n      </ul>\r\n   </div>\r\n   \x3c!--/.nav-collapse --\x3e\r\n</div>\r\n<div class="contributorsLink" style="position: absolute; right:7px; bottom:15px">\r\n   <icsm-contributors-link></icsm-contributors-link>\r\n</div>\r\n\x3c!-- Strap --\x3e\r\n<div class="row">\r\n   <div class="col-md-12">\r\n      <div class="strap-blue">\r\n      </div>\r\n      <div class="strap-white">\r\n      </div>\r\n      <div class="strap-red">\r\n      </div>\r\n   </div>\r\n</div>'),e.put("icsm/help/faqs.html",'<p style="text-align: left; margin: 10px; font-size: 14px;">\r\n   <strong>FAQS</strong>\r\n</p>\r\n\r\n<h5 ng-repeat="faq in faqs"><button type="button" class="undecorated" ng-click="focus(faq.key)">{{faq.question}}</button></h5>\r\n<hr/>\r\n<div class="row" ng-repeat="faq in faqs">\r\n   <div class="col-md-12">\r\n      <h5 tabindex="0" id="faqs_{{faq.key}}">{{faq.question}}</h5>\r\n      <span ng-bind-html="faq.answer"></span>\r\n      <hr/>\r\n   </div>\r\n</div>'),e.put("icsm/help/help.html",'<p style="text-align: left; margin: 10px; font-size: 14px;">\r\n\t<strong>Help</strong>\r\n</p>\r\n\r\n<div class="panel-body" ng-controller="HelpCtrl as help">\r\n\tThe steps to get data!\r\n\t<ol>\r\n\t\t<li>Define area of interest</li>\r\n\t\t<li>Select datasets</li>\r\n\t\t<li>Confirm selections</li>\r\n\t\t<li>Enter email address and industry</li>\r\n\t\t<li>Start extract</li>\r\n\t</ol>\r\n\tOne or more emails will be sent to you on completion of the data extract(s) with a link to your data.\r\n   <hr>\r\n\t<icsm-faqs faqs="help.faqs" ></icsm-faqs>\r\n</div>'),e.put("icsm/imagery/launch.html",'<button type="button" class="undecorated" title="View preview of imagery" ng-click="preview()" ng-if="show">\r\n\t<i class="fa fa-lg fa-eye"></i>\r\n</button>'),e.put("icsm/message/message.html","<div class=\"well well-sm mess-container\" ng-show=\"message.type && message.text\"\r\n   ng-class=\"{'mess-error': message.type == 'error', 'mess-warn': message.type == 'warn', 'mess-info': (message.type == 'info' || message.type == 'wait')}\">\r\n   <i class=\"fa fa-spinner fa-spin fa-fw\" aria-hidden=\"true\" ng-if=\"message.type == 'wait'\"></i>\r\n   <span>{{message.text}}</span>\r\n</div>"),e.put("icsm/panes/panes.html",'<div class="mapContainer" class="col-md-12" style="padding-right:0"  ng-attr-style="right:{{right.width}}">\r\n   <span common-baselayer-control class="baselayer-slider" max-zoom="16" title="Satellite to Topography bias on base map."></span>\r\n   <div class="panesMapContainer" geo-map configuration="data.map">\r\n      <geo-extent></geo-extent>\r\n      <icsm-layerswitch></icsm-layerswitch>\r\n   </div>\r\n   <div class="base-layer-controller">\r\n      <div geo-draw data="data.map.drawOptions" line-event="elevation.plot.data" rectangle-event="bounds.drawn" polygon-event="polygon.drawn"></div>\r\n   </div>\r\n   <restrict-pan bounds="data.map.position.bounds"></restrict-pan>\r\n</div>'),e.put("icsm/panes/tabs.html",'\x3c!-- tabs go here --\x3e\r\n<div id="panesTabsContainer" class="paneRotateTabs" style="opacity:0.9" ng-style="{\'right\' : contentLeft +\'px\'}">\r\n\r\n   <div class="paneTabItem" style="width:60px; opacity:0">\r\n\r\n   </div>\r\n   <div class="paneTabItem" ng-class="{\'bold\': view == \'download\'}" ng-click="setView(\'download\')">\r\n      <button class="undecorated">Datasets Download</button>\r\n   </div>\r\n   \x3c!--\r\n\t<div class="paneTabItem" ng-class="{\'bold\': view == \'search\'}" ng-click="setView(\'search\')">\r\n\t\t<button class="undecorated">Search</button>\r\n\t</div>\r\n\t<div class="paneTabItem" ng-class="{\'bold\': view == \'maps\'}" ng-click="setView(\'maps\')">\r\n\t\t<button class="undecorated">Layers</button>\r\n\t</div>\r\n   --\x3e\r\n   <div class="paneTabItem" ng-class="{\'bold\': view == \'downloader\'}" ng-click="setView(\'downloader\')">\r\n      <button class="undecorated">Products Download</button>\r\n   </div>\r\n   <div class="paneTabItem" ng-class="{\'bold\': view == \'glossary\'}" ng-click="setView(\'glossary\')">\r\n      <button class="undecorated">Glossary</button>\r\n   </div>\r\n   <div class="paneTabItem" ng-class="{\'bold\': view == \'help\'}" ng-click="setView(\'help\')">\r\n      <button class="undecorated">Help</button>\r\n   </div>\r\n</div>'),e.put("icsm/preview/preview.html",'<div class="preview-container" ng-if="previewData">\r\n   <div class="preview-blocker" ng-click="clear()"></div>\r\n\r\n   <div style="position:absolute; right: 10px; z-index: 1; top:20px">\r\n      <div class="pull-right">\r\n         <button type="button" class="btn btn-primary" ng-click="clear()" autofocus>Hide</button>\r\n      </div>\r\n   </div>\r\n   <img width="600" class="preview-image" ng-src="{{previewData.url}}"></img>\r\n</div>'),e.put("icsm/products/download.html",'<div class="well" ng-show="item.showDownload">\r\n\r\n   <div class="well">\r\n      <div ng-show="processing.validClip" class="product-restrict">\r\n         <span class="product-label">Bounds:</span> {{processing.clip.xMin|number : 4}}&deg; west, {{processing.clip.yMax|number : 4}}&deg; north, {{processing.clip.xMax|number\r\n         : 4}}&deg; east, {{processing.clip.yMin|number : 4}}&deg; south\r\n\r\n         <div ng-show="processing.message" class="product-warning">\r\n            {{processing.message}}\r\n         </div>\r\n      </div>\r\n      <product-projection processing="processing"></product-projection>\r\n      <br/>\r\n      <product-formats processing="processing"></product-formats>\r\n      <br/>\r\n      <product-email processing="processing"></product-email>\r\n   </div>\r\n   <product-download-submit processing="processing" item="item"></product-download-submit>\r\n</div>'),e.put("icsm/products/email.html",'<div class="input-group">\r\n      <span class="input-group-addon" id="nedf-email">Email</span>\r\n      <input required="required" type="email" ng-model="processing.email" class="form-control" placeholder="Email address to send download link">\r\n   </div>\r\n'),e.put("icsm/products/formats.html",'<div class="row">\r\n      <div class="col-md-4">\r\n         <label for="geoprocessOutputFormat">\r\n                  Output Format\r\n               </label>\r\n      </div>\r\n      <div class="col-md-8">\r\n         <select id="geoprocessOutputFormat" style="width:95%" ng-model="processing.outFormat" ng-options="opt.value for opt in config.outFormat track by opt.code"></select>\r\n      </div>\r\n   </div>'),e.put("icsm/products/projection.html",'<div class="row">\r\n   <div class="col-md-4">\r\n      <label for="geoprocessOutCoordSys">\r\n                  Coordinate System\r\n               </label>\r\n   </div>\r\n   <div class="col-md-8">\r\n      <select id="geoprocessOutCoordSys" style="width:95%" ng-model="processing.outCoordSys" ng-options="opt.value for opt in config.outCoordSys | productIntersect : processing.clip track by opt.code"></select>\r\n   </div>\r\n</div>'),e.put("icsm/products/submit.html",'<div class="well" style="padding-bottom:2px">\r\n   <div class="row">\r\n      <div class="col-md-6" style="padding-top:7px">\r\n         <div class="progress">\r\n            <div class="progress-bar" role="progressbar" aria-valuenow="{{processing.percentComplete}}" aria-valuemin="0" aria-valuemax="100"\r\n               style="width: {{processing.percentComplete}}%;">\r\n               <span class="sr-only">60% Complete</span>\r\n            </div>\r\n         </div>\r\n      </div>\r\n      <div class="col-md-4" style="padding-top:7px">\r\n         <span style="padding-right:10px" uib-tooltip="Draw a valid area to extract data." tooltip-placement="left">\r\n            <i class="fa fa-scissors fa-2x" ng-class="{\'product-valid\': processing.validClipSize, \'product-invalid\': !processing.validClipSize }"></i>\r\n         </span>\r\n         <span style="padding-right:10px" uib-tooltip="Select a valid coordinate system for area." tooltip-placement="left">\r\n            <i class="fa fa-file-video-o fa-2x" ng-class="{\'product-valid\': processing.validProjection, \'product-invalid\': !processing.validProjection}"></i>\r\n         </span>\r\n         <span style="padding-right:10px" uib-tooltip="Select a valid download format." tooltip-placement="left">\r\n            <i class="fa fa-files-o fa-2x" ng-class="{\'product-valid\': processing.validFormat, \'product-invalid\': !processing.validFormat}"></i>\r\n         </span>\r\n         <span style="padding-right:10px" uib-tooltip="Provide an email address." tooltip-placement="left">\r\n            <i class="fa fa-envelope fa-2x" ng-class="{\'product-valid\': processing.validEmail, \'product-invalid\': !processing.validEmail}"></i>\r\n         </span>\r\n      </div>\r\n      <div class="col-md-2">\r\n         <button class="btn btn-primary pull-right" ng-disabled="!processing.valid" ng-click="submit()">Submit</button>\r\n      </div>\r\n   </div>\r\n</div>'),e.put("icsm/results/abstractbutton.html",'<button ng-show="show" type="button" class="undecorated" title="View full title and abstract of this dataset" ng-click="toggle()">\r\n\t<i class="fa fa-lg" ng-class="{\'fa-caret-down active\':item.showAbstract, \'fa-caret-right\':!item.showAbstract}"></i>\r\n</button>'),e.put("icsm/results/abstracttooltip.html","<div>\r\n{{item.metadata.title? item.metadata.title: 'Loading...'}}\r\n</div>"),e.put("icsm/results/continue.html",'<div class="continue-container" ng-show="ctrl.selected.length">\r\n   <div class="warn-limit alert-danger" ng-show="ctrl.selectedSize > limit">\r\n      There is a {{limit | fileSize}} limit per request.<br/>\r\n      Remove some selections or decrease the size of the selected area.\r\n   </div>\r\n   <button ng-disabled="ctrl.selectedSize > limit" class="btn btn-primary" ng-click="ctrl.review()">Download {{ctrl.selected.length | number}} selected datasets... (Approx: {{ctrl.selectedSize | fileSize}})</button>\r\n</div>\r\n\r\n'),e.put("icsm/results/orgheading.html",'<h5>\r\n   <img ng-src="{{mappings[org.source].image}}" ng-attr-style="height:{{mappings[org.source].height}}px"></img>\r\n      <strong>{{heading()}}</strong> (Showing {{org.downloadables | countMatchedDownloadables | number:0}} of {{org.downloadables\t| countDownloadables | number:0}})\r\n</h5>'),e.put("icsm/results/results.html",'<div ng-show="!list || !list.length">\r\n   <div class="alert alert-warning" role="alert">\r\n      <strong>Select an area</strong> to find datasets within.</div>\r\n</div>\r\n\r\n<div ng-show="list.length" class="results-list">\r\n   <div class="row">\r\n      <div class="col-md-12" uib-tooltip="Number of intersecting or very near datasets to your area of interest.">\r\n         <h4 style="display:inline-block; padding-left:7px">Found {{products.length | number:0}} datasets</h4>\r\n      </div>\r\n   </div>\r\n   <div class="panel panel-default" style="margin-bottom: 5px; margin-top: 0;">\r\n      <div class="panel-body" style="float:clear">\r\n         <span class="filter-text" style="float:left;width:50%">\r\n            <div class="input-group input-group-sm">\r\n               <span class="input-group-addon" id="names1">Filter:</span>\r\n               <input type="text" ng-model="filters.filter" class="form-control" ng-change="update()" placeholder="Filter names" aria-describedby="names1">\r\n            </div>\r\n         </span>\r\n         <span class="filter-type" style="padding:10px; float:right">\r\n            <span class="listTypeLabel">Filter by type:</span>\r\n            <span ng-repeat="type in filters.types" class="listType">\r\n               <input type="checkbox" ng-model="type.selected" ng-change="update()" />\r\n               <span uib-tooltip="{{type.description}}">{{type.label}}</span>\r\n            </span>\r\n         </span>\r\n      </div>\r\n   </div>\r\n\r\n   <div ng-repeat="available in list" class="well" style="padding-left:4px;padding-right:4px" ng-show="list.someMatches(available)"\r\n      ng-controller="listCtrl as list">\r\n      <icsm-org-heading org="available" mappings="mappings"></icsm-org-heading>\r\n      <div>\r\n         <div class="listRow" ng-class-odd="\'listEven\'" ng-repeat="(typeKey, types) in available.downloadables | allowedTypes" ng-show="types | hasTypeMatches">\r\n            <span>\r\n               <h5>{{typeKey}}</h5>\r\n            </span>\r\n\r\n            <div ng-if="typeKey === \'Unreleased Data\'">\r\n               <icsm-unreleased types="types">\r\n            </div>\r\n            <div ng-if="typeKey !== \'Unreleased Data\'">\r\n               <div ng-repeat="(key, items) in types" ng-show="(items | countMatchedItems) != 0">\r\n                  <div>\r\n                     <h5>\r\n                        <button ng-click="list.checkChildren(items)" style="width:7em" class="btn btn-xs btn-default">\r\n                           <span ng-show="!list.childrenChecked(items)">Select all</span>\r\n                           <span ng-show="list.childrenChecked(items)">Deselect all</span>\r\n                        </button>\r\n                        <span uib-tooltip="{{filter.types[key].description}}">{{key}} (Showing {{items | countMatchedItems | number:0}} of {{items.length | number:0}})</span>\r\n\r\n\r\n                        <button class="pull-right undecorated" ng-click="expansions[available.source + \'_\' + key] = !expansions[available.source + \'_\' + key]">\r\n                           [{{expansions[available.source + \'_\' + key]?"hide ":"show "}} list]\r\n                        </button>\r\n                     </h5>\r\n                  </div>\r\n                  <div ng-show="expansions[available.source + \'_\' + key]">\r\n                     <subtype items="items" mappings="mappings" show="show" hide="hide"></subtype>\r\n                     <div style="text-align:right">\r\n                        <button class="undecorated" ng-click="expansions[available.source + \'_\' + key] = false">[hide list]</button>\r\n                     </div>\r\n                  </div>\r\n               </div>\r\n            </div>\r\n         </div>\r\n      </div>\r\n   </div>\r\n</div>'),e.put("icsm/results/subtype.html",'<div ng-show="(items | matchedItems).length > paging.pageSize"\r\n   paging page="paging.page" page-size="paging.pageSize"\r\n   total="(items | matchedItems).length"\r\n   paging-action="setPage(page, pageSize)">\r\n</div>\r\n<div>\r\n   <div ng-repeat="item in data" icsm-abstract-hover item="item">\r\n      <div tooltip-append-to-body="true" uib-tooltip-template="\'icsm/results/abstracttooltip.html\'" tooltip-popup-delay="400" data-ng-mouseenter="show(item)"\r\n         data-ng-mouseleave="hide(item)">\r\n         <input type="checkbox" ng-model="item.selected" />\r\n         <icsm-abstract item="item"></icsm-abstract>\r\n         <common-cc version="mappings[item.source].ccLicence"></common-cc>\r\n         <launch-image item="item" ng-if="item.thumb_url"></launch-image>\r\n         <span class="listItem" item="item" icsm-abstract-link></span>\r\n         <span ng-show="item.file_size" style="float:right;padding-top:3px">({{item.file_size | fileSize}})</span>\r\n         <span ng-show="item.product" style="float:right;padding-top:3px" title="Product size will depend on size of chosen area, data coverage and resolution. An email will be sent after the extraction giving the exact size of the extracted data and a link to the product.">(Product &lt; 500MB)</span>\r\n      </div>\r\n      <div ng-show="item.showAbstract" class="well">\r\n         <span ng-show="!item.metadata">\r\n            <i class="fa fa-spinner fa-spin fa-lg fa-fw"></i>\r\n            <span>Loading metadata...</span>\r\n         </span>\r\n         <div ng-show="item.metadata.abstract">\r\n            <strong>{{item.metadata.title}}</strong> -\r\n            <span class="icsm-abstract-body" ng-bind-html="item.metadata.abstractText"></span>\r\n         </div>\r\n         <div ng-show="!item.metadata.abstract">\r\n            <i class="fa fa-lg fa-exclamation-triangle" style="color:orange"></i>\r\n            Can\'t show abstract for this dataset.\r\n         </div>\r\n      </div>\r\n   </div>\r\n</div>'),e.put("icsm/results/unreleased.html",'<div ng-repeat="(key, items) in types" ng-show="(items | countMatchedItems) != 0">\r\n   <div style="padding-left:8px">\r\n      <h5>\r\n         <span uib-tooltip="{{filter.types[key].description}}">{{key}} (Showing {{items | countMatchedItems | number:0}} of {{items.length | number:0}})</span>\r\n\r\n         <button class="pull-right undecorated" ng-click="expansions[\'unreleased_\' + items[0].source + \'_\' + key] = !expansions[\'unreleased_\' + items[0].source + \'_\' + key]">\r\n            [{{expansions[\'unreleased_\' + items[0].source + \'_\' + key]?"hide ":"show "}} list]\r\n         </button>\r\n      </h5>\r\n   </div>\r\n   <div ng-show="expansions[\'unreleased_\' + items[0].source + \'_\' + key]">\r\n      <div ng-repeat="item in items | matchedItems" icsm-abstract-hover item="item">\r\n         <div tooltip-append-to-body="true" uib-tooltip-template="\'icsm/results/abstracttooltip.html\'" tooltip-popup-delay="400" data-ng-mouseenter="show(item)"\r\n            data-ng-mouseleave="hide(item)" style="padding-left:8px;">\r\n            <icsm-abstract item="item"></icsm-abstract>\r\n            <button type="button" class="undecorated" disabled="disabled" title="Licence details pending release.">\r\n               <i class="fa fa-lg fa-gavel"></i>\r\n            </button>\r\n            <span class="listItem" name="project_name" item="item" icsm-abstract-link></span>\r\n            <span ng-show="item.file_size" style="float:right;padding-top:3px">({{item.file_size | fileSize}})</span>\r\n         </div>\r\n         <div ng-show="item.showAbstract" class="well" style="margin-bottom:0px">\r\n            <span ng-show="!item.metadata">\r\n               <i class="fa fa-spinner fa-spin fa-lg fa-fw"></i>\r\n               <span>Loading metadata...</span>\r\n            </span>\r\n            <div ng-show="item.metadata.abstract">\r\n               <strong>{{item.metadata.title}}</strong> -\r\n               <span class="icsm-abstract-body" ng-bind-html="item.metadata.abstractText"></span>\r\n            </div>\r\n            <div ng-show="!item.metadata.abstract">\r\n               <i class="fa fa-lg fa-exclamation-triangle" style="color:orange"></i>\r\n               There is no abstract available for this dataset.\r\n            </div>\r\n         </div>\r\n         <div style="padding-left:12px">\r\n            <div>\r\n               <strong style="width:7em">Captured: </strong>{{item.captured | captured}}\r\n            </div>\r\n            <div ng-if="item.available_date">\r\n               <strong style="width:7em">Available: </strong>{{item.available_date | reverseDate}}\r\n            </div>\r\n            <div>\r\n               <strong style="width:7em">Contact: </strong>\r\n               <a href="mailTo:{{item.contact}}">{{item.contact}}</a>\r\n            </div>\r\n         </div>\r\n      </div>\r\n\r\n      <div style="text-align:right">\r\n         <button class="undecorated" ng-click="expansions[\'unreleased_\' + items[0].source + \'_\' + key] = false">[hide list]</button>\r\n      </div>\r\n   </div>\r\n</div>'),e.put("icsm/select/doc.html",'<div ng-class-odd="\'odd\'" ng-class-even="\'even\'" ng-mouseleave="select.lolight(doc)" ng-mouseenter="select.hilight(doc)">\r\n\t<span ng-class="{ellipsis:!expanded}" tooltip-enable="!expanded" style="width:100%;display:inline-block;"\r\n\t\t\ttooltip-class="selectAbstractTooltip" tooltip="{{doc.abstract | truncate : 250}}" tooltip-placement="bottom">\r\n\t\t<button type="button" class="undecorated" ng-click="expanded = !expanded" title="Click to see more about this dataset">\r\n\t\t\t<i class="fa pad-right fa-lg" ng-class="{\'fa-caret-down\':expanded,\'fa-caret-right\':(!expanded)}"></i>\r\n\t\t</button>\r\n\t\t<download-add item="doc" group="group"></download-add>\r\n\t\t<icsm-wms data="doc"></icsm-wms>\r\n\t\t<icsm-bbox data="doc" ng-if="doc.showExtent"></icsm-bbox>\r\n\t\t<a href="https://ecat.ga.gov.au/geonetwork/srv/eng/search#!{{doc.primaryId}}" target="_blank" ><strong>{{doc.title}}</strong></a>\r\n\t</span>\r\n\t<span ng-class="{ellipsis:!expanded}" style="width:100%;display:inline-block;padding-right:15px;">\r\n\t\t{{doc.abstract}}\r\n\t</span>\r\n\t<div ng-show="expanded" style="padding-bottom: 5px;">\r\n\t\t<h5>Keywords</h5>\r\n\t\t<div>\r\n\t\t\t<span class="badge" ng-repeat="keyword in doc.keywords track by $index">{{keyword}}</span>\r\n\t\t</div>\r\n\t</div>\r\n</div>'),e.put("icsm/select/group.html",'<div class="panel panel-default" style="margin-bottom:-5px;" >\r\n\t<div class="panel-heading"><icsm-wms data="group"></icsm-wms> <strong>{{group.title}}</strong></div>\r\n\t<div class="panel-body">\r\n   \t\t<div ng-repeat="doc in group.docs">\r\n   \t\t\t<div select-doc doc="doc" group="group"></div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n'),e.put("icsm/select/select.html",'<div>\r\n\t<div style="position:relative;padding:5px;padding-left:10px;" ng-controller="SelectCtrl as select" class="scrollPanel">\r\n\t\t<div class="panel panel-default" style="margin-bottom:-5px">\r\n  \t\t\t<div class="panel-heading">\r\n  \t\t\t\t<h3 class="panel-title">Available datasets</h3>\r\n  \t\t\t</div>\r\n  \t\t\t<div class="panel-body">\r\n\t\t\t\t<div ng-repeat="doc in select.data.response.docs" style="padding-bottom:7px">\r\n\t\t\t\t\t<div select-doc ng-if="doc.type == \'dataset\'" doc="doc"></div>\r\n\t\t\t\t\t<select-group ng-if="doc.type == \'group\'" group="doc"></select-group>\r\n\t\t\t\t</div>\r\n  \t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>'),e.put("icsm/reviewing/reviewing.html",'<div class="modal-header">\r\n   <h3 class="modal-title splash">Download datasets by providing email address and start extract</h3>\r\n</div>\r\n<div class="modal-body" id="accept" ng-form exp-enter="accept()" icsm-splash-modal style="width: 100%; margin-left: auto; margin-right: auto;">\r\n   <div class="row bg-warning" ng-show="noneSelected(products)">\r\n      <div class="col-md-2">\r\n         <button type="button" style="float:right" class="btn btn-primary" ng-click="cancel()">Close</button>\r\n      </div>\r\n   </div>\r\n   <div ng-controller="listCtrl as list">\r\n      <div class="row">\r\n         <div class="col-md-12">\r\n            <strong>\r\n               {{list.selected.length}} Selected Datasets\r\n               <span ng-show="list.selectedSize">(Approx: {{list.selectedSize | fileSize}})</span>\r\n            </strong>\r\n         </div>\r\n      </div>\r\n   </div>\r\n   <div ng-repeat="org in products">\r\n      <h5>\r\n         <img ng-src="{{mappings[org.source].image}}" ng-attr-style="height:{{mappings[org.source].height}}px"></img>\r\n         <strong>{{heading(org.source)}}</strong>\r\n      </h5>\r\n      <div style="padding-left:10px" ng-repeat="(key, subGroup) in org.downloadables">\r\n         <h5>{{key}}</h5>\r\n         <div style="padding-left:10px;" ng-repeat="(name, items) in subGroup">\r\n            <h5 title="Clipped product using coordinate System: {{data.outCoordSys.value}}, Output Format: {{data.outFormat.value}}">\r\n               {{name}}\r\n               <span style="padding-left:25px;font-size:90%">\r\n                  {{items.length | number :0}} items\r\n                  <span ng-if="items | hasProducts">{{items | productsSummary}}</span>\r\n                  totalling {{items | reviewSumSize | fileSize}}</span>\r\n            </h5>\r\n         </div>\r\n      </div>\r\n\r\n   </div>\r\n\r\n   <div ng-controller="listCtrl as list">\r\n      <div ng-if="list.selected | hasTransformables" class="well" style="padding:7px">\r\n         <h5 style="margin-top:4px">{{list.selected | transformablesCount}} item(s) are downloads which you can elect to transform into a different coordinate system and file format</h5>\r\n         <span products-dialog>\r\n            <product-projection processing="data"></product-projection>\r\n            <product-formats processing="data"></product-formats>\r\n         </span>\r\n      </div>\r\n   </div>\r\n\r\n   <div class="row reviewing-divider">\r\n      <div class="col-md-12" style="padding-bottom: 8px">\r\n         <div review-industry></div>\r\n      </div>\r\n      <div class="col-md-12">\r\n         <div review-email></div>\r\n      </div>\r\n   </div>\r\n   <div class="row" ng-controller="listCtrl as list">\r\n      <div class="col-md-8">\r\n         <strong>Email notification</strong> The extract of data can take some time. By providing an email address we will be able\r\n         to notify you when the job is complete. The email will provide a link to the extracted data which will be packaged\r\n         up as a single compressed file.\r\n\r\n         <div\r\n            vc-recaptcha\r\n            theme="\'light\'"\r\n            key="recaptchaKey"\r\n            on-create="setWidgetId(widgetId)"\r\n            on-success="setResponse(response)"\r\n            on-expire="cbExpiration()"></div>\r\n      </div>\r\n      <div class="col-md-4">\r\n         <div class="pull-right" style="padding:8px;">\r\n            <button type="button" class="btn btn-primary" ng-click="accept()" ng-disabled="!data.industry || !data.email || !list.selected.length || !recaptchaResponse">Start extract of datasets\r\n            </button>\r\n            <button type="button" class="btn btn-primary" ng-click="cancel()">Cancel</button>\r\n         </div>\r\n      </div>\r\n   </div>\r\n</div>'),e.put("icsm/side-panel/side-panel-left.html",'<div class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-left" style="width: {{left.width}}px;" ng-class="{\'cbp-spmenu-open\': left.active}">\r\n    <a href="" title="Close panel" ng-click="closeLeft()" style="z-index: 1200">\r\n        <span class="glyphicon glyphicon-chevron-left pull-right"></span>\r\n    </a>\r\n    <div ng-show="left.active === \'legend\'" class="left-side-menu-container">\r\n        <legend url="\'img/AustralianTopogaphyLegend.png\'" title="\'Map Legend\'"></legend>\r\n    </div>\r\n</div>'),e.put("icsm/side-panel/side-panel-right.html",'<div class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-right noPrint" ng-attr-style="width:{{right.width}}" ng-class="{\'cbp-spmenu-open\': right.active}">\r\n    <a href="" title="Close panel" ng-click="closePanel()" style="z-index: 1">\r\n        <span class="glyphicon glyphicon-chevron-right pull-left"></span>\r\n    </a>\r\n\r\n    <div class="right-side-menu-container" ng-show="right.active === \'download\'" icsm-view></div>\r\n    <div class="right-side-menu-container" ng-show="right.active === \'maps\'" icsm-maps></div>\r\n    <div class="right-side-menu-container" ng-show="right.active === \'glossary\'" icsm-glossary></div>\r\n    <div class="right-side-menu-container" ng-show="right.active === \'help\'" icsm-help></div>\r\n    <panel-close-on-event only-on="search" event-name="clear.button.fired"></panel-close-on-event>\r\n</div>\r\n'),e.put("icsm/splash/splash.html",'<div class="modal-header">\r\n   <h3 class="modal-title splash">Elevation - Foundation Spatial Data</h3>\r\n</div>\r\n<div class="modal-body" id="accept" ng-form exp-enter="accept()" icsm-splash-modal style="width: 100%; margin-left: auto; margin-right: auto;">\r\n\t<div>\r\n\t\t<p>\r\n\t\t\tHere you can download point cloud and elevation datasets sourced from jurisdictions.\r\n\t\t</p>\r\n\t\t<p>\r\n\t\t\t<a href="http://www.ga.gov.au/topographic-mapping/digital-elevation-data.html" target="_blank">Find out more on our Elevation page.</a>\r\n\t\t</p>\r\n\t\t<p>\r\n         Data can be downloaded at <strong>no charge</strong> but note that there is a <strong>15GB limit per request</strong> (please check the file size before you download your files).\r\n\t\t</p>\r\n\t\t<p>\r\n\t\t\t<a href="http://opentopo.sdsc.edu/gridsphere/gridsphere?cid=contributeframeportlet&gs_action=listTools" target="_blank">Click here for Free GIS Tools.</a>\r\n\t\t</p>\r\n      <h5>How to use</h5>\r\n      <p>\r\n         <ul>\r\n            <li>Pan and zoom the map to your area of interest,</li>\r\n            <li>Click on one of the "Select area by..." buttons to define your area of interest,\r\n               <ul>\r\n                  <li>\r\n                        <img style="height:26px;padding-right:10px" src="icsm/resources/img/draw_rectangle.png">Drawing a bounding box. On enabling, click on the map and drag diagonally. There is a limit of roughly 2 square degrees or 200 square km.\r\n                  </li>\r\n                  <li>\r\n                     <img style="height:26px;padding-right:10px" src="icsm/resources/img/draw_polygon.png">\r\n                     Drawing a polygon. On enabling, click on the map for each vertex, click on the first vertex to close the polygon. Don\'t do too many vertices, it will not afford you greater accuracy and will slow down your search.\r\n                  </li>\r\n                  <li>\r\n                     <i class="fa fa-keyboard-o fa-2x" style="padding-right:10px" aria-hidden="true"></i>\r\n                      Manually entering the minimum and maximum latitudes and longitudes. The same area restrictions apply to drawing the bounds.\r\n                  </li>\r\n               </ul>\r\n            </li>\r\n            <li>On drawing complete we will check for data within or very near your area of interest</li>\r\n            <li>If the list is large you can filter:\r\n               <ul>\r\n                  <li>Partial text match by typing in the filter field and/or</li>\r\n                  <li>You can restrict the display to either elevation (DEM) or point cloud file types</li>\r\n               </ul>\r\n            </li>\r\n            <li>Check against any file you would like to download. To reiterate, these files can be huge so take note of the file size before downloading</li>\r\n            <li>Review your selected datasets and submit.</li>\r\n            <li>An email will be sent to you with a link to all your data, zipped into a single file.</li>\r\n            <li>These files can be huge so take note of the file size before submitting or downloading</li>\r\n         </ul>\r\n      </p>\r\n      <h5>Hints</h5>\r\n      <p>\r\n         <ul>\r\n            <li>Hovering over many items will give you further information about the purpose of the item</li>\r\n            <li>Drawing a polyline allows you to measure distance along the polyline.</li>\r\n            <li>On completion on drawing a line the elevation along that line is plotted.</li>\r\n            <li>While the tool to draw your area of interest is enabled it is easiest to pan the map using the arrow keys.</li>\r\n            <li>There are many areas where there is no data though the coverage is improving all the time.</li\r\n         </ul>\r\n      </p>\r\n\t</div>\r\n   <div style="padding:30px; padding-top:0; padding-bottom:40px; width:100%">\r\n\t\t<div class="pull-right">\r\n\t\t  \t<button type="button" class="btn btn-primary" ng-model="seenSplash" ng-click="accept()" autofocus>Continue</button>\r\n\t\t</div>\r\n\t</div>\r\n</div>'),e.put("icsm/themes/themes.html",'<div class="dropdown themesdropdown">\r\n  <button class="btn btn-default dropdown-toggle themescurrent" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">\r\n    Theme\r\n    <span class="caret"></span>\r\n  </button>\r\n  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">\r\n    <li ng-repeat="item in themes">\r\n       <a href="#" title="{{item.title}}" ng-href="{{item.url}}" class="themesItemCompact">\r\n         <span class="icsm-icon" ng-class="item.className"></span>\r\n         <strong style="vertical-align:top;font-size:110%">{{item.label}}</strong>\r\n       </a>\r\n    </li>\r\n  </ul>\r\n</div>'),e.put("icsm/toolbar/toolbar.html",'<div class="elevation-toolbar noPrint">\r\n   <div class="toolBarContainer">\r\n      <div>\r\n         <ul class="left-toolbar-items">\r\n            <li>\r\n               <div class="btn-group searchBar" ng-show="root.whichSearch != \'region\'">\r\n                  <div class="input-group input-group-custom" geo-search>\r\n                     <input type="text" ng-autocomplete ng-model="values.from.description" options=\'{country:"au"}\'\r\n                        size="32" title="Select a locality to pan the map to." class="form-control" aria-label="...">\r\n                     <div class="input-group-btn">\r\n                        <button ng-click="zoom(false)"\r\n                           class="btn btn-default" title="Pan and potentially zoom to location.">\r\n                           <i class="fa fa-search"></i>\r\n                        </button>\r\n                     </div>\r\n                  </div>\r\n               </div>\r\n            </li>\r\n         </ul>\r\n         <ul class="right-toolbar-items">\r\n            <li coverage-toggle></li>\r\n            <li>\r\n               <panel-trigger panel-id="download" panel-width="590px" name="Download" default="default"\r\n                  icon-class="fa-list" title="Select an area of interest and select datasets for download">\r\n               </panel-trigger>\r\n            </li>\r\n            <li>\r\n               <panel-trigger panel-id="help" panel-width="590px" name="Help" icon-class="fa-question-circle-o"\r\n                  title="Show help"></panel-trigger>\r\n            </li>\r\n            <li>\r\n               <panel-trigger panel-id="glossary" panel-width="590px" name="Glossary" icon-class="fa-book"\r\n                  title="Show glossary"></panel-trigger>\r\n            </li>\r\n            <li reset-page></li>\r\n         </ul>\r\n      </div>\r\n   </div>\r\n</div>'),e.put("icsm/view/view.html",'<div class="container-fluid downloadPane">\r\n   <icsm-clip data="data.item"></icsm-clip>\r\n   <div class="list-container">\r\n      <icsm-list></icsm-list>\r\n   </div>\r\n   <div class="downloadCont" icsm-search-continue></div>\r\n</div>')}]);